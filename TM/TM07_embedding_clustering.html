

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>TM07 embedding and clustering &#8212; Programming for Social Scientists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/.ipynb_checkpoints/custom-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'TM/TM07_embedding_clustering';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TM07 word2vec vs doc2vec" href="TM07_2_doc2vec.html" />
    <link rel="prev" title="TM06 Clustering" href="TM06_Clustering.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Programming for Social Scientists
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Logic</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P01_counting.html">P01-Counting</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P01p_counting.html">P01-Practice</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P02_0_basic.html">P02-Python Basic</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P02p_basic.html">Practices 02 for Python basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P02_2_exceptions.html">Exceptions(Errors) Handling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P03_list_dictionary.html">P03-List and Dictionary</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P03p.html">P03 Practice: Accessing dict and list</a></li>

<li class="toctree-l2"><a class="reference internal" href="../PSS/P03p_ans.html">P03 Practice: Accessing dict and list</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P04_for.html">P04 Flow Control</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p1_for.html">P04 Practice01: for loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p2_search_maximum.html">P04 Practice02 Search &amp; Maximum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p3_twitter_users.html">P04 Practice03 Twitter Users</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P05_read_csv_json.html">P05 READ Files</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p1_read_csv.html">P05-1 Read CSV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p2_read_json.html">P05-2 Load and dump ubike json data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p3_read_other_format.html">Read more formats</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P06_pandas.html">P06 Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p1_summarizing.html">Pandas: Counting and Summarizing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p2_filter_select_datetime.html">Pandas: filter, select, and timeline process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p3_timestamp.html">P06-3 Processing timestamp</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P07_0_visualization.html">P07 Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P07_1_plot_pandas.html">Making Charts with Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P07_2_bokeh.html">Bokeh &amp; Seaborn(Vaccinating)</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Acquisition</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P08_0_scraper.html">P08 Web Crawler</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_1_web_json.html">Web API: cnyes &amp; 104.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_2_twitter_api.html">Twitter API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_3%20tweepy.html">Tweepy for twitter API 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_5_cases.html">Scraping cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../PSS/P08_4_ptt_crawler.html">P08 HTML Parsing - Crawling PTT</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Mining</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="TM01_tokenization.html">TM01 Tokenization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="TM01_tokenization%28chi%29.html">Chinese Processing</a></li>





</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TM02_collocation.html">TM02 Collocation</a></li>

<li class="toctree-l1"><a class="reference internal" href="TM03_POS%20Tagging.html">TM03 POS Tagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM04_IR_search.html">TM04 Feature Selection &amp; IR &amp; Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM05_sentiment.html">TM05 Sentiment analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="TM06_Clustering.html">TM06 Clustering</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">TM07 embedding and clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM07_2_doc2vec.html">TM07 word2vec vs doc2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM08_doc_classification.html">TM08 Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM09_BERTopic.html">TM09 Topic Modeling by BERtopic</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using deep learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/drive/1pXfdPEQDY5wDhlzjr867duFsAVAXj5Yz?usp=sharing">Transformer-Clusteirng</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/drive/1YD8mjrpEH6-0rYMY0L1xFFKpJ2jGY6nT?usp=share_link">Transformer-Classification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Compuational Social Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../CSS/CSS01_network_analysis.html">CSS01 Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CSS/CSS02_Simulation.html">CSS02 Simulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../AS/AS01_basic.html">AS01 for Python Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_ptt_jsonl.html">AS02 Reading PTT data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_ptt_jsonl_ans.html">AS02 Reading PTT data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_list_dict_for_if.html">AS02 List-dict-for-if</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS03_summarize_ptt.html">AS03: Summarizing Data by Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS03_pandas_summarization.html">AS03 Summarize data with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS04_vis_twitter_api.html">AS04 Twitter API and Pandas Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS05_scraping_youtube.html">AS05 Scraping youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS05_Scraping_youtube_with_chatGPT.html">AS05. Improving Youtube Scraper with ChatGPT</a></li>




<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1L9coxxzKsy7_KzrBWno6Jh9zY785AtJB/view?usp=sharing">AS06 Tokenization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS06_Tokenization.html">AS06 - Tokenization and keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS07_collocation.html">AS07 Collocation for finding enthusiastic commentors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS08_clustering_yt_comment.html">AS08 Youtube comment clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS08_clustering_people.html">AS08 - Clustering Commenters Based on Behavior</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Resource/video_list.html">Python教學影片</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Resource/IDEs.html">Python開發環境</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/p4css/py4css/blob/master/_sources/TM/TM07_embedding_clustering.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/p4css/py4css" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="來源儲存庫"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/p4css/py4css/issues/new?title=Issue%20on%20page%20%2FTM/TM07_embedding_clustering.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="開啟議題"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="下載此頁面">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/TM/TM07_embedding_clustering.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="下載原始檔"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="列印成 PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全螢幕模式"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>TM07 embedding and clustering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目錄 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process">Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#term-frequency">Term frequency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-stopwords">Loading stopwords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-chinese-punctuation">Detecting Chinese punctuation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-word2vec-model">Building word2vec model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-model">Building model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-similarity">Testing Similarity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualized-with-dimension-reduction">Visualized with Dimension reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-top-150-to-visualize">Retrieve top 150 to visualize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-by-pca">Reduced by PCA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-by-t-sne">Reduced by t-SNE</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-by-matplotlib-or-seaborn">Plot by matplotlib or seaborn</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-by-bokeh">plot by bokeh</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doc-clustering-with-embeddings">Doc clustering with embeddings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sum-up-wordvec-to-docvec">Sum up wordvec to docvec</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-numpy-array">Convert to numpy array</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduce-dimension-by-tsne">Reduce dimension by tsne</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduce-dimension-by-umap">Reduce dimension by umap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustering-by-hdbscan">Clustering by hdbscan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plotting</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tm07-embedding-and-clustering">
<h1>TM07 embedding and clustering<a class="headerlink" href="#tm07-embedding-and-clustering" title="Permalink to this headline">#</a></h1>
<p>在做文本聚類（Document Clustering）的時候，即使抽出每個文本的關鍵字，也有可能會有聚類效果不好（群與群之間分不開）的情形。這其中一種可能的原因是文本中有非常多意義相近或類型相近的名詞，但在計算的時候被視為不同的文字。例如在政治類文本中的「小英」或「蔡英文」意指同一個人，但在計算上就是兩個相異詞；又如下列兩個句子，叉燒和豆花都是一種食品，在句子中的位置非常接近，但如果就以抽關鍵字與文字作為特徵向量的方法來做文件比對，這就是兩個完全相異的詞。所以，我們想要找到一種方法，能夠讓「叉燒」和「豆花」這兩個字的表徵「Representation」相近一些。</p>
<ul class="simple">
<li><p>這家的「叉燒」不好吃</p></li>
<li><p>這家的招牌「豆花」令人感到失望</p></li>
</ul>
<p>「詞嵌入（Word embeddings）」的想法是，從上面兩句話來看，可以發現「叉燒」與「豆花」兩個字周遭的句法結構是非常接近的，而且主要是「店家+食品+評價」的句法結構。所以，可以嘗試把「叉燒」或「豆花」周遭的文字作為該詞的表徵（除了自己本身以外），這也可以簡單地說是一個詞出現的脈絡。如果可以用這樣的方式表徵「叉燒」與「豆花」，那自然「店家」或「評價」也可以被這樣表徵，同時就克服了「叉燒」與「豆花」周遭的文字也有可能會有意思相近的情形。</p>
<p>詞嵌入：將一個詞周遭一定範圍內的字詞（除了該詞本身）作為該詞的表徵。</p>
<section id="process">
<h2>Process<a class="headerlink" href="#process" title="Permalink to this headline">#</a></h2>
<p>整體過程如下圖：</p>
<ol class="arabic simple">
<li><p>從一個文本有哪些字中，會建立一出每個字周遭w個字作為其脈絡的矩陣，亦即以周遭文字為特徵的term-term matrix。</p></li>
<li><p>之後會將該矩陣轉為一個等長的向量矩陣，每個字的周遭脈絡轉為300維。前兩個步驟為詞嵌入的過程，一般來說會是用word2vec的演算法做，抽取預測下一個字詞的第一層節點的權重來作為向量。</p></li>
<li><p>根據每篇文章有哪些詞，挑選（或不挑選）TF-IDF的向量做加總（為向量運算，加總後要除以加總的向量數）。</p></li>
<li><p>可得到每篇文章的向量。該向量長度會等於前面的文字向量。</p></li>
<li><p>這些向量就是該篇文章的特徵，就類似原本的群集法一樣，把每篇文章有哪些文字當作其特徵。有了這些特徵後，就可以往下做Clustering。</p></li>
</ol>
<p><img alt="Alt text" src="../_images/TM07_1.png" /></p>
</section>
<section id="loading-data">
<h2>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">#</a></h2>
<p>這邊用作範例的資料仍然是在<a class="reference internal" href="TM06_Clustering.html#tm06-clustering"><span class="std std-ref">TM06 Clustering</span></a>所使用的評價留言。之前透過TF-IDF抽取關鍵字在群集的效果並不好，希望這個例子可以有所改善。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !mkdir ./data</span>
<span class="c1"># !wget -P ./data -N https://github.com/p4css/py4css/raw/main/data/sentiment.csv</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/sentiment.csv&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">jieba</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;token_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">jieba</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Building prefix dict from the default dictionary ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading model from cache /var/folders/j3/p4x0mssx55nd8dn903h5wdb00000gn/T/jieba.cache
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading model cost 0.274 seconds.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prefix dict has been built successfully.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tag</th>
      <th>text</th>
      <th>token_text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P</td>
      <td>店家很給力，快遞也是相當快，第三次光顧啦</td>
      <td>[店家, 很, 給力, ，, 快遞, 也, 是, 相當快, ，, 第三次, 光顧, 啦]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N</td>
      <td>這樣的配置用Vista系統還是有點卡。 指紋收集器。 沒送原裝滑鼠還需要自己買，不太好。</td>
      <td>[這樣, 的, 配置, 用, Vista, 系統, 還是, 有點, 卡, 。,  , 指紋,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P</td>
      <td>不錯，在同等檔次酒店中應該是值得推薦的！</td>
      <td>[不錯, ，, 在, 同等, 檔次, 酒店, 中應, 該, 是, 值得, 推薦, 的, ！]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>N</td>
      <td>哎！ 不會是蒙牛乾的吧 嚴懲真凶！</td>
      <td>[哎, ！,  , 不會, 是, 蒙牛, 乾, 的, 吧,  , 嚴懲, 真凶, ！]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>N</td>
      <td>空尤其是三立電視臺女主播做的序尤其無趣像是硬湊那麼多字</td>
      <td>[空, 尤其, 是, 三立, 電視, 臺, 女主播, 做, 的, 序, 尤其, 無趣, 像是...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="term-frequency">
<h2>Term frequency<a class="headerlink" href="#term-frequency" title="Permalink to this headline">#</a></h2>
<section id="loading-stopwords">
<h3>Loading stopwords<a class="headerlink" href="#loading-stopwords" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !wget https://raw.githubusercontent.com/p4css/py4css/main/data/sentiment.csv -O stopwords_zh-tw.txt </span>
<span class="c1"># !wget https://raw.githubusercontent.com/p4css/py4css/main/data/sentiment.csv -P data/</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/stopwords_zh-tw.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">stopwords</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stop words: &quot;</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stopwords</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">remove_stopWords</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>


<span class="kn">import</span> <span class="nn">unicodedata</span> <span class="c1"># for removing Chinese puctuation</span>
<span class="k">def</span> <span class="nf">remove_punc_by_unicode</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;token_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">remove_stopWords</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">remove_punc_by_unicode</span><span class="p">)</span>
<span class="c1"># for i in range(df.shape[0]):</span>
<span class="c1">#     if len(df[&#39;cleaned&#39;][i]) == 0:</span>
<span class="c1">#         df[&#39;cleaned&#39;][i] = df[&#39;token_text&#39;][i]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>stop words:  [&#39;?&#39;, &#39;、&#39;, &#39;。&#39;, &#39;“&#39;, &#39;”&#39;, &#39;《&#39;, &#39;》&#39;, &#39;！&#39;, &#39;「&#39;, &#39;」&#39;, &#39;『&#39;, &#39;』&#39;, &#39;，&#39;, &#39;：&#39;, &#39;；&#39;, &#39;？&#39;, &#39;人民&#39;, &#39;末##末&#39;, &#39;啊&#39;, &#39;阿&#39;, &#39;哎&#39;, &#39;哎呀&#39;, &#39;哎喲&#39;, &#39;唉&#39;, &#39;我&#39;, &#39;我們&#39;, &#39;按&#39;, &#39;按照&#39;, &#39;依照&#39;, &#39;吧&#39;, &#39;吧噠&#39;, &#39;把&#39;, &#39;罷了&#39;, &#39;被&#39;, &#39;本&#39;, &#39;本著&#39;, &#39;比&#39;, &#39;比方&#39;, &#39;比如&#39;, &#39;鄙人&#39;, &#39;彼&#39;, &#39;彼此&#39;, &#39;邊&#39;, &#39;別&#39;, &#39;別的&#39;, &#39;別說&#39;, &#39;並&#39;, &#39;並且&#39;, &#39;不比&#39;, &#39;不成&#39;, &#39;不單&#39;, &#39;不但&#39;, &#39;不獨&#39;, &#39;不管&#39;, &#39;不光&#39;, &#39;不過&#39;, &#39;不僅&#39;, &#39;不拘&#39;, &#39;不論&#39;, &#39;不怕&#39;, &#39;不然&#39;, &#39;不如&#39;, &#39;不特&#39;, &#39;不惟&#39;, &#39;不問&#39;, &#39;不只&#39;, &#39;朝&#39;, &#39;朝著&#39;, &#39;趁&#39;, &#39;趁著&#39;, &#39;乘&#39;, &#39;沖&#39;, &#39;除&#39;, &#39;除此之外&#39;, &#39;除非&#39;, &#39;除了&#39;, &#39;此&#39;, &#39;此間&#39;, &#39;此外&#39;, &#39;從&#39;, &#39;從而&#39;, &#39;打&#39;, &#39;待&#39;, &#39;但&#39;, &#39;但是&#39;, &#39;當&#39;, &#39;當著&#39;, &#39;到&#39;, &#39;得&#39;, &#39;的&#39;, &#39;的話&#39;, &#39;等&#39;, &#39;等等&#39;, &#39;地&#39;, &#39;第&#39;, &#39;叮咚&#39;, &#39;對&#39;, &#39;對於&#39;, &#39;多&#39;, &#39;多少&#39;]
1212
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tag</th>
      <th>text</th>
      <th>token_text</th>
      <th>cleaned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P</td>
      <td>店家很給力，快遞也是相當快，第三次光顧啦</td>
      <td>[店家, 很, 給力, ，, 快遞, 也, 是, 相當快, ，, 第三次, 光顧, 啦]</td>
      <td>[店家, 給力, 快遞, 相當快, 第三次, 光顧]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N</td>
      <td>這樣的配置用Vista系統還是有點卡。 指紋收集器。 沒送原裝滑鼠還需要自己買，不太好。</td>
      <td>[這樣, 的, 配置, 用, Vista, 系統, 還是, 有點, 卡, 。,  , 指紋,...</td>
      <td>[配置, Vista, 系統, 有點, 卡, 指紋, 收集器, 沒送, 原裝, 滑鼠, 需要...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P</td>
      <td>不錯，在同等檔次酒店中應該是值得推薦的！</td>
      <td>[不錯, ，, 在, 同等, 檔次, 酒店, 中應, 該, 是, 值得, 推薦, 的, ！]</td>
      <td>[不錯, 同等, 檔次, 酒店, 中應, 值得, 推薦]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>N</td>
      <td>哎！ 不會是蒙牛乾的吧 嚴懲真凶！</td>
      <td>[哎, ！,  , 不會, 是, 蒙牛, 乾, 的, 吧,  , 嚴懲, 真凶, ！]</td>
      <td>[蒙牛, 乾, 嚴懲, 真凶]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>N</td>
      <td>空尤其是三立電視臺女主播做的序尤其無趣像是硬湊那麼多字</td>
      <td>[空, 尤其, 是, 三立, 電視, 臺, 女主播, 做, 的, 序, 尤其, 無趣, 像是...</td>
      <td>[空, 尤其, 三立, 電視, 臺, 女主播, 做, 序, 尤其, 無趣, 像是, 硬, 湊...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="detecting-chinese-punctuation">
<h3>Detecting Chinese punctuation<a class="headerlink" href="#detecting-chinese-punctuation" title="Permalink to this headline">#</a></h3>
<p>以下先觀察資料的詞頻（依照高至低排列）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Take a look at the most common words (from high to low)</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">word_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">tok</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">word_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>蒙牛 	 1556
不錯 	 907
酒店 	 385
房間 	 366
感覺 	 350
外觀 	 294
系統 	 276
價格 	 269
價效 	 262
螢幕 	 258
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="building-word2vec-model">
<h2>Building word2vec model<a class="headerlink" href="#building-word2vec-model" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Reference: <a class="reference external" href="https://radimrehurek.com/gensim/models/word2vec.html">https://radimrehurek.com/gensim/models/word2vec.html</a></p></li>
</ul>
<section id="building-model">
<h3>Building model<a class="headerlink" href="#building-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vector_size</span></code>: 每個詞要表徵為多少維度的向量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window</span></code>: 每個詞的表徵要納入前後多少個詞。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">Word2Vec</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;token_text&#39;</span><span class="p">],</span> <span class="n">min_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vector_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-similarity">
<h3>Testing Similarity<a class="headerlink" href="#testing-similarity" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Number of dimensions of the NumPy array: <code class="docutils literal notranslate"><span class="pre">.ndim</span></code></p></li>
<li><p>Shape of the NumPy array: <code class="docutils literal notranslate"><span class="pre">.shape</span></code></p></li>
<li><p>Size of the NumPy array: <code class="docutils literal notranslate"><span class="pre">.size</span></code></p></li>
<li><p>Size of the first dimension of the NumPy array: <code class="docutils literal notranslate"><span class="pre">len()</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="s2">&quot;火鍋&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="s2">&quot;火鍋&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="s2">&quot;火鍋&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="s2">&quot;火鍋&quot;</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="s2">&quot;蒙牛&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(300,)
300
1
300
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.6486264 ,  1.2839541 ,  0.4647647 ,  0.25804135, -0.6508056 ,
       -0.7755656 ,  1.5711412 ,  1.7253138 ,  0.64658916, -0.8042531 ,
        0.9068587 ,  0.2596401 , -0.57733256,  0.26439682, -0.5747352 ,
       -1.4444346 ,  0.9132578 , -0.33393157, -0.30622298, -0.21383551,
       -0.01348746,  0.16750278,  0.66514933,  0.2600685 ,  1.5146604 ,
       -0.4374927 , -1.5150077 ,  0.18827416, -1.170934  , -1.1034362 ,
       -1.2057776 , -0.32536423,  0.78189194, -0.09191829, -0.10302221,
        0.84631234,  0.9559213 , -1.363472  , -0.61936444, -0.1520851 ,
       -0.59931016,  0.6608721 ,  0.15378703, -0.61872244,  0.6932668 ,
        0.32488227,  0.68179166,  0.7254961 ,  0.2795956 ,  0.96611917,
        0.4597748 ,  0.25067216, -1.2270039 ,  1.1262997 , -0.27749622,
        0.33450878,  0.93841136, -0.01425851, -0.22296962, -0.09611441,
       -0.9530657 ,  0.0754924 , -0.13009146,  0.5299912 , -0.02631811,
        0.42982647,  0.00356824,  0.7815955 , -0.56549966, -0.13662939,
       -0.2505473 ,  0.8720645 ,  0.4319085 , -0.715172  ,  0.80014   ,
       -0.33786643, -0.5343071 , -0.13029838, -0.1996671 ,  0.5383754 ,
       -0.38680238, -0.5129123 ,  0.1467007 ,  1.6237634 , -0.21310173,
        0.27968252,  0.53980327, -0.3280192 ,  0.5930331 ,  1.0983684 ,
        0.6666945 , -0.35182783,  0.19773531, -0.30552363,  1.5924085 ,
        1.3394291 ,  0.50497776, -0.706188  , -0.26267105,  0.5686332 ,
       -0.65812576, -0.01160147,  0.50226396,  0.07252582,  0.7642681 ,
       -0.84753305, -0.5315198 , -0.00380521, -0.97942513,  0.30652708,
       -0.8235023 , -0.5614852 , -0.00665872,  0.13883072,  1.0296398 ,
        0.33786583, -0.155199  ,  1.1482476 ,  1.2099931 , -1.0912958 ,
        0.8137937 ,  0.5095932 ,  0.62171733,  0.16446193, -0.27443787,
        0.69884974, -0.04367781, -0.96716595, -0.04596223,  0.9881258 ,
        0.5803292 ,  0.96401536,  0.15437903, -1.4685087 ,  0.11149985,
        0.594289  , -0.22478667, -0.3259569 , -0.6532674 , -1.0107874 ,
        1.1906911 , -1.5811852 , -0.50411206,  0.22821188,  0.41206363,
        0.08085896, -1.4921471 , -0.568035  ,  0.95796967, -0.8195607 ,
        0.7882892 , -1.5716481 , -0.82373786, -0.36165345, -0.30318806,
        0.64230597, -1.0051455 , -0.6853926 , -0.17373288,  0.938241  ,
        0.5820976 ,  1.056467  , -1.2894676 ,  0.9721718 , -0.05097925,
        0.6802785 ,  0.17230828, -0.5878375 ,  0.30647784,  1.4960136 ,
       -1.1042094 ,  0.31053662,  0.53181577,  0.35562363,  0.34954405,
        0.8812314 , -0.25193924, -0.31147477,  0.20301935, -0.65610355,
       -0.20291877,  0.06173914, -0.9745782 , -0.39554262, -0.6754909 ,
        0.11394715,  1.0035502 ,  0.27271622,  0.5560501 , -0.8667731 ,
        0.57577705, -0.0974331 , -0.61578786, -0.08795714,  0.46194562,
       -1.3247302 ,  0.2967019 , -1.306173  , -0.50227547, -0.09214276,
       -0.58557105, -0.3032573 ,  0.14672558, -0.84955066,  0.59859675,
       -0.55773157, -0.6391725 ,  0.71255994,  0.2558101 , -0.40682536,
       -0.23942122, -0.8081004 , -0.8296217 , -0.4893214 ,  0.90424913,
       -0.5996837 , -0.4646296 , -1.3042033 , -0.76245683, -0.8906502 ,
        0.8987067 ,  0.25098222, -0.70185286, -0.6323147 ,  0.1246307 ,
       -0.17956014, -0.10413178, -0.48641583, -0.6770361 ,  0.5578214 ,
        0.11657704, -0.37861848, -0.1209176 , -0.6300888 , -0.3566798 ,
        0.46556017,  0.0606421 ,  0.45734566,  0.239908  , -0.22698319,
        0.39272806, -0.15757905,  0.00790359, -0.4197918 ,  0.5507819 ,
       -0.96530807, -0.36107433, -0.06931114, -0.06516588,  0.8525366 ,
        0.14385977,  0.17889665,  0.35283178,  0.07401979, -0.08905447,
        0.18024658,  1.4297009 ,  0.29457554, -0.39919862, -0.5131284 ,
        0.03627985, -0.35110787, -0.04563269, -0.5374699 , -0.8821727 ,
       -0.19041625,  0.7343568 , -0.18136796,  0.01653812,  0.74565274,
       -0.4878392 , -0.24883601, -0.20600183,  0.12063647,  0.7596265 ,
        0.7437245 ,  0.9930627 ,  0.2159723 , -0.4282943 , -0.0119855 ,
        0.7985183 , -0.00256542,  0.34940287, -0.21965039, -0.17712215,
        0.42064393, -1.0539266 ,  0.9181972 ,  0.18819089,  0.79178345,
        0.11471542,  0.10310536,  0.5139838 , -0.13312945,  0.20038739,
        1.1664927 ,  0.2847314 , -0.12940584,  0.28123596, -0.9340779 ],
      dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  他 : 工程師 = 她 : ?</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">most_similar</span><span class="p">([</span><span class="s2">&quot;火鍋&quot;</span><span class="p">,</span> <span class="s2">&quot;好吃&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;廁所&quot;</span><span class="p">],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
<span class="c1">#  他 : 醫師 = 她 : ?</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">most_similar</span><span class="p">([</span><span class="s2">&quot;鍵盤&quot;</span><span class="p">,</span> <span class="s2">&quot;工具&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;垃圾&quot;</span><span class="p">],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39; &#39;, 0.9383964538574219), (&#39;開心&#39;, 0.9376777410507202), (&#39;哈&#39;, 0.9372609853744507), (&#39;c&#39;, 0.9367742538452148), (&#39;牛&#39;, 0.936487078666687), (&#39;家&#39;, 0.9361705780029297), (&#39;哈哈&#39;, 0.9359670877456665), (&#39;哈哈哈&#39;, 0.9357056021690369), (&#39;好喝&#39;, 0.935541570186615), (&#39;乳&#39;, 0.9355025887489319), (&#39;還送&#39;, 0.9352087378501892), (&#39;搬&#39;, 0.9351895451545715), (&#39;負責任&#39;, 0.9349329471588135), (&#39;搞笑&#39;, 0.9345370531082153), (&#39;厲害&#39;, 0.9345003962516785), (&#39;分享&#39;, 0.9341186881065369), (&#39;幸福&#39;, 0.9341084957122803), (&#39;哦&#39;, 0.9339812994003296), (&#39;冠益&#39;, 0.9338603615760803), (&#39;一瓶&#39;, 0.9338527917861938)]
----------------------------------------
[(&#39;過得&#39;, 0.3989500403404236), (&#39;敞亮&#39;, 0.38468247652053833), (&#39;側看&#39;, 0.35764020681381226), (&#39;手段&#39;, 0.33499032258987427), (&#39;附樓&#39;, 0.3337630033493042), (&#39;報價要&#39;, 0.3305216431617737), (&#39;相比之下&#39;, 0.3300393521785736), (&#39;籃球場&#39;, 0.32836097478866577), (&#39;靠邊&#39;, 0.3282523453235626), (&#39;鄭州算&#39;, 0.3276059627532959), (&#39;力推&#39;, 0.32654258608818054), (&#39;價啊&#39;, 0.3260200023651123), (&#39;服務還&#39;, 0.3211151659488678), (&#39;k8i8&#39;, 0.32043349742889404), (&#39;地點&#39;, 0.31402334570884705), (&#39;字鍵&#39;, 0.3119300305843353), (&#39;缺憾&#39;, 0.3109230399131775), (&#39;臨海屬&#39;, 0.30777427554130554), (&#39;別墅式&#39;, 0.3073461651802063), (&#39;不相關&#39;, 0.3058667480945587)]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualized-with-dimension-reduction">
<h2>Visualized with Dimension reduction<a class="headerlink" href="#visualized-with-dimension-reduction" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://medium.com/marketingdatascience/%E8%A7%A3%E6%B1%BApython-3-matplotlib%E8%88%87seaborn%E8%A6%96%E8%A6%BA%E5%8C%96%E5%A5%97%E4%BB%B6%E4%B8%AD%E6%96%87%E9%A1%AF%E7%A4%BA%E5%95%8F%E9%A1%8C-f7b3773a889b">Matplotlib顯示中文問題: Win</a></p></li>
<li><p><a class="reference external" href="https://hoishing.medium.com/using-chinese-characters-in-matplotlib-5c49dbb6a2f7">Using Chinese Characters in Matplotlib</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="c1"># </span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Heiti TC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1728x1152 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<section id="retrieve-top-150-to-visualize">
<h3>Retrieve top 150 to visualize<a class="headerlink" href="#retrieve-top-150-to-visualize" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">word_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">150</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="n">word</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;蒙牛&#39;, &#39;不錯&#39;, &#39;酒店&#39;, &#39;房間&#39;, &#39;感覺&#39;, &#39;外觀&#39;, &#39;系統&#39;, &#39;價格&#39;, &#39;價效&#39;, &#39;螢幕&#39;, &#39;喜歡&#39;, &#39;方便&#39;, &#39;有點&#39;, &#39;比較&#39;, &#39;功能&#39;, &#39;服務&#39;, &#39;一個&#39;, &#39;配置&#39;, &#39;問題&#39;, &#39;不好&#39;, &#39;速度&#39;, &#39;時間&#39;, &#39;鍵盤&#39;, &#39;支援&#39;, &#39;知道&#39;, &#39;電池&#39;, &#39;XP&#39;, &#39;效果&#39;, &#39;質量&#39;, &#39;還不錯&#39;, &#39;驅動&#39;, &#39;散熱&#39;, &#39;記憶體&#39;, &#39;抵制&#39;, &#39;東西&#39;, &#39;伊利&#39;, &#39;漂亮&#39;, &#39;滿意&#39;, &#39;顯示&#39;, &#39;牛奶&#39;, &#39;早餐&#39;, &#39;收到&#39;, &#39;使用&#39;, &#39;安裝&#39;, &#39;內容&#39;, &#39;做工&#39;, &#39;效能&#39;, &#39;這本書&#39;, &#39;便宜&#39;, &#39;環境&#39;, &#39;很快&#39;, &#39;設施&#39;, &#39;聲音&#39;, &#39;適合&#39;, &#39;發現&#39;, &#39;手感&#39;, &#39;一點&#39;, &#39;現在&#39;, &#39;容易&#39;, &#39;朋友&#39;, &#39;光碟&#39;, &#39;真的&#39;, &#39;硬碟&#39;, &#39;已經&#39;, &#39;機器&#39;, &#39;應該&#39;, &#39;覺得&#39;, &#39;麻煩&#39;, &#39;產品&#39;, &#39;好看&#39;, &#39;舒服&#39;, &#39;電腦&#39;, &#39;位置&#39;, &#39;值得&#39;, &#39;希望&#39;, &#39;一下&#39;, &#39;入住&#39;, &#39;沒什麼&#39;, &#39;設計&#39;, &#39;特別&#39;, &#39;一本&#39;, &#39;待機&#39;, &#39;執行&#39;, &#39;小巧&#39;, &#39;很大&#39;, &#39;京東&#39;, &#39;送貨&#39;, &#39;下次&#39;, &#39;軟體&#39;, &#39;不到&#39;, &#39;包裝&#39;, &#39;本本&#39;, &#39;還行&#39;, &#39;很漂亮&#39;, &#39;品牌&#39;, &#39;真是&#39;, &#39;太小&#39;, &#39;介面&#39;, &#39;需要&#39;, &#39;鈴聲&#39;, &#39;總體&#39;, &#39;推薦&#39;, &#39;失望&#39;, &#39;攝像頭&#39;, &#39;一直&#39;, &#39;垃圾&#39;, &#39;比高&#39;, &#39;手機&#39;, &#39;想象&#39;, &#39;選擇&#39;, &#39;機子&#39;, &#39;客服&#39;, &#39;交通&#39;, &#39;小時&#39;, &#39;孩子&#39;, &#39;實用&#39;, &#39;還算&#39;, &#39;呵呵&#39;, &#39;相當&#39;, &#39;購買&#39;, &#39;滑鼠&#39;, &#39;只能&#39;, &#39;態度&#39;, &#39;電話&#39;, &#39;晚上&#39;, &#39;酸奶&#39;, &#39;下載&#39;, &#39;味道&#39;, &#39;完美&#39;, &#39;還好&#39;, &#39;看到&#39;, &#39;一些&#39;, &#39;xp&#39;, &#39;地方&#39;, &#39;簡單&#39;, &#39;好像&#39;, &#39;建議&#39;, &#39;太差&#39;, &#39;時尚&#39;, &#39;服務態度&#39;, &#39;方面&#39;, &#39;這款&#39;, &#39;vista&#39;, &#39;拿到&#39;, &#39;同事&#39;, &#39;齊全&#39;, &#39;外殼&#39;, &#39;水器&#39;, &#39;MP3&#39;, &#39;噹噹&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="reduced-by-pca">
<h3>Reduced by PCA<a class="headerlink" href="#reduced-by-pca" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">points</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 4.44459865,  6.8125545 ],
       [ 4.05878354, -2.73271617],
       [ 4.2682364 , -1.32937738],
       [ 5.14695915, -1.77125621],
       [ 3.66540378,  0.02591022],
       [ 3.37069251, -1.89068319],
       [ 3.93278142,  0.81953756],
       [ 2.8881863 , -0.94962571],
       [ 3.06811533, -2.57692935],
       [ 3.47511829, -0.86359389],
       [ 1.23108049,  1.48861453],
       [ 2.93262028, -1.16507533],
       [ 4.15867192,  1.03553746],
       [ 3.85229188, -0.95343434],
       [ 2.94948936, -0.54914408],
       [ 2.5173107 , -1.35260855],
       [ 2.75949284,  1.4683455 ],
       [ 2.40548233, -1.49098608],
       [ 1.83381153,  1.4496228 ],
       [ 2.57032984,  0.44314079]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="reduced-by-t-sne">
<h3>Reduced by t-SNE<a class="headerlink" href="#reduced-by-t-sne" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>

<span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> 

<span class="n">points</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jirlong/opt/anaconda3/lib/python3.9/site-packages/sklearn/manifold/_t_sne.py:780: FutureWarning: The default initialization in TSNE will change from &#39;random&#39; to &#39;pca&#39; in 1.2.
  warnings.warn(
/Users/jirlong/opt/anaconda3/lib/python3.9/site-packages/sklearn/manifold/_t_sne.py:790: FutureWarning: The default learning rate in TSNE will change from 200.0 to &#39;auto&#39; in 1.2.
  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 3.9516475,  7.115057 ],
       [10.902903 ,  5.7807426],
       [ 9.996472 ,  6.334165 ],
       [10.469364 ,  6.6008763],
       [ 8.242114 ,  6.4420133],
       [10.266692 ,  5.279134 ],
       [ 7.3857756,  6.8003488],
       [ 9.142384 ,  5.039799 ],
       [10.80628  ,  4.9502153],
       [ 9.086709 ,  5.7713184],
       [ 3.4560845,  5.0124016],
       [ 9.477276 ,  5.009169 ],
       [ 7.221954 ,  6.9667387],
       [ 9.41859  ,  6.123211 ],
       [ 8.45689  ,  5.252422 ],
       [ 9.699712 ,  4.359071 ],
       [ 5.84302  ,  6.3329015],
       [ 9.724508 ,  4.160966 ],
       [ 4.3924627,  5.5226855],
       [ 6.8011537,  5.468903 ]], dtype=float32)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">#</a></h2>
<section id="plot-by-matplotlib-or-seaborn">
<h3>Plot by matplotlib or seaborn<a class="headerlink" href="#plot-by-matplotlib-or-seaborn" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fig = plt.gcf()</span>
<span class="c1"># fig.set_size_inches(24, 16)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span> 
<span class="c1"># plt.figure(figsize=(8, 6), dpi=300) </span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Heiti TC&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-12.982230186462402,
 12.040289878845215,
 -11.605185222625732,
 8.00649709701538)
</pre></div>
</div>
<img alt="../_images/51db6b13c0876549f1a6dc21631c6ecb5911dda01d29838f73842063bffb22a7.png" src="../_images/51db6b13c0876549f1a6dc21631c6ecb5911dda01d29838f73842063bffb22a7.png" />
</div>
</div>
</section>
<section id="plot-by-bokeh">
<h3>plot by bokeh<a class="headerlink" href="#plot-by-bokeh" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/40450943/adding-labels-to-a-bokeh-plot">https://stackoverflow.com/questions/40450943/adding-labels-to-a-bokeh-plot</a></p></li>
<li><p><a class="reference external" href="https://docs.bokeh.org/en/latest/docs/user_guide/annotations.html">https://docs.bokeh.org/en/latest/docs/user_guide/annotations.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">scatter</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span>
<span class="n">scatter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.951648</td>
      <td>7.115057</td>
      <td>蒙牛</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.902903</td>
      <td>5.780743</td>
      <td>不錯</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9.996472</td>
      <td>6.334165</td>
      <td>酒店</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10.469364</td>
      <td>6.600876</td>
      <td>房間</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.242114</td>
      <td>6.442013</td>
      <td>感覺</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>-9.913163</td>
      <td>-10.709945</td>
      <td>齊全</td>
    </tr>
    <tr>
      <th>146</th>
      <td>-9.047916</td>
      <td>-6.890789</td>
      <td>外殼</td>
    </tr>
    <tr>
      <th>147</th>
      <td>-5.571010</td>
      <td>-5.167821</td>
      <td>水器</td>
    </tr>
    <tr>
      <th>148</th>
      <td>-11.017619</td>
      <td>-9.553266</td>
      <td>MP3</td>
    </tr>
    <tr>
      <th>149</th>
      <td>-11.206729</td>
      <td>-5.899322</td>
      <td>噹噹</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install bokeh</span>
<span class="c1"># !pip install jupyter_bokeh</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">LabelSet</span><span class="p">,</span> <span class="n">Range1d</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    <div class="bk-root">
        <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
        <span id="1002">Loading BokehJS ...</span>
    </div></div><script type="application/javascript">
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

  const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;
    // Clean up Bokeh references
    if (id != null && id in Bokeh.index) {
      Bokeh.index[id].model.document.clear();
      delete Bokeh.index[id];
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim();
            if (id in Bokeh.index) {
              Bokeh.index[id].model.document.clear();
              delete Bokeh.index[id];
            }
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }

  
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    const el = document.getElementById("1002");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }


  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  
  const js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.4.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-2.4.2.min.js"];
  const css_urls = [];
  

  const inline_js = [
    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
    function(Bokeh) {
    
    
    }
  ];

  function run_inline_js() {
    
    if (root.Bokeh !== undefined || force === true) {
      
    for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
    if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("1002")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }

  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;w2v&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">scatter</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">scatter</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                  <span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                  <span class="n">source</span><span class="o">=</span><span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">scatter</span><span class="p">),</span> <span class="n">render_mode</span><span class="o">=</span><span class="s1">&#39;canvas&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





  <div class="bk-root" id="90b8b751-ed51-4354-a7d2-60be9c4eab8f" data-root-id="1003"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
    
  const docs_json = {"ce64a561-b0ad-4b70-b35e-3c08e1ac615d":{"defs":[],"roots":{"references":[{"attributes":{"below":[{"id":"1014"}],"center":[{"id":"1017"},{"id":"1021"},{"id":"1043"}],"left":[{"id":"1018"}],"renderers":[{"id":"1040"}],"title":{"id":"1004"},"toolbar":{"id":"1029"},"x_range":{"id":"1006"},"x_scale":{"id":"1010"},"y_range":{"id":"1008"},"y_scale":{"id":"1012"}},"id":"1003","subtype":"Figure","type":"Plot"},{"attributes":{"axis":{"id":"1014"},"coordinates":null,"group":null,"ticker":null},"id":"1017","type":"Grid"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"hatch_alpha":{"value":0.1},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1038","type":"Circle"},{"attributes":{},"id":"1019","type":"BasicTicker"},{"attributes":{},"id":"1048","type":"AllLabels"},{"attributes":{},"id":"1023","type":"WheelZoomTool"},{"attributes":{"coordinates":null,"formatter":{"id":"1047"},"group":null,"major_label_policy":{"id":"1048"},"ticker":{"id":"1019"}},"id":"1018","type":"LinearAxis"},{"attributes":{},"id":"1047","type":"BasicTickFormatter"},{"attributes":{"coordinates":null,"data_source":{"id":"1036"},"glyph":{"id":"1037"},"group":null,"hover_glyph":null,"muted_glyph":{"id":"1039"},"nonselection_glyph":{"id":"1038"},"view":{"id":"1041"}},"id":"1040","type":"GlyphRenderer"},{"attributes":{},"id":"1015","type":"BasicTicker"},{"attributes":{"coordinates":null,"group":null,"text":"w2v"},"id":"1004","type":"Title"},{"attributes":{},"id":"1008","type":"DataRange1d"},{"attributes":{"axis":{"id":"1018"},"coordinates":null,"dimension":1,"group":null,"ticker":null},"id":"1021","type":"Grid"},{"attributes":{},"id":"1027","type":"HelpTool"},{"attributes":{},"id":"1022","type":"PanTool"},{"attributes":{},"id":"1026","type":"ResetTool"},{"attributes":{},"id":"1025","type":"SaveTool"},{"attributes":{"data":{"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149],"label":["\u8499\u725b","\u4e0d\u932f","\u9152\u5e97","\u623f\u9593","\u611f\u89ba","\u5916\u89c0","\u7cfb\u7d71","\u50f9\u683c","\u50f9\u6548","\u87a2\u5e55","\u559c\u6b61","\u65b9\u4fbf","\u6709\u9ede","\u6bd4\u8f03","\u529f\u80fd","\u670d\u52d9","\u4e00\u500b","\u914d\u7f6e","\u554f\u984c","\u4e0d\u597d","\u901f\u5ea6","\u6642\u9593","\u9375\u76e4","\u652f\u63f4","\u77e5\u9053","\u96fb\u6c60","XP","\u6548\u679c","\u8cea\u91cf","\u9084\u4e0d\u932f","\u9a45\u52d5","\u6563\u71b1","\u8a18\u61b6\u9ad4","\u62b5\u5236","\u6771\u897f","\u4f0a\u5229","\u6f02\u4eae","\u6eff\u610f","\u986f\u793a","\u725b\u5976","\u65e9\u9910","\u6536\u5230","\u4f7f\u7528","\u5b89\u88dd","\u5167\u5bb9","\u505a\u5de5","\u6548\u80fd","\u9019\u672c\u66f8","\u4fbf\u5b9c","\u74b0\u5883","\u5f88\u5feb","\u8a2d\u65bd","\u8072\u97f3","\u9069\u5408","\u767c\u73fe","\u624b\u611f","\u4e00\u9ede","\u73fe\u5728","\u5bb9\u6613","\u670b\u53cb","\u5149\u789f","\u771f\u7684","\u786c\u789f","\u5df2\u7d93","\u6a5f\u5668","\u61c9\u8a72","\u89ba\u5f97","\u9ebb\u7169","\u7522\u54c1","\u597d\u770b","\u8212\u670d","\u96fb\u8166","\u4f4d\u7f6e","\u503c\u5f97","\u5e0c\u671b","\u4e00\u4e0b","\u5165\u4f4f","\u6c92\u4ec0\u9ebc","\u8a2d\u8a08","\u7279\u5225","\u4e00\u672c","\u5f85\u6a5f","\u57f7\u884c","\u5c0f\u5de7","\u5f88\u5927","\u4eac\u6771","\u9001\u8ca8","\u4e0b\u6b21","\u8edf\u9ad4","\u4e0d\u5230","\u5305\u88dd","\u672c\u672c","\u9084\u884c","\u5f88\u6f02\u4eae","\u54c1\u724c","\u771f\u662f","\u592a\u5c0f","\u4ecb\u9762","\u9700\u8981","\u9234\u8072","\u7e3d\u9ad4","\u63a8\u85a6","\u5931\u671b","\u651d\u50cf\u982d","\u4e00\u76f4","\u5783\u573e","\u6bd4\u9ad8","\u624b\u6a5f","\u60f3\u8c61","\u9078\u64c7","\u6a5f\u5b50","\u5ba2\u670d","\u4ea4\u901a","\u5c0f\u6642","\u5b69\u5b50","\u5be6\u7528","\u9084\u7b97","\u5475\u5475","\u76f8\u7576","\u8cfc\u8cb7","\u6ed1\u9f20","\u53ea\u80fd","\u614b\u5ea6","\u96fb\u8a71","\u665a\u4e0a","\u9178\u5976","\u4e0b\u8f09","\u5473\u9053","\u5b8c\u7f8e","\u9084\u597d","\u770b\u5230","\u4e00\u4e9b","xp","\u5730\u65b9","\u7c21\u55ae","\u597d\u50cf","\u5efa\u8b70","\u592a\u5dee","\u6642\u5c1a","\u670d\u52d9\u614b\u5ea6","\u65b9\u9762","\u9019\u6b3e","vista","\u62ff\u5230","\u540c\u4e8b","\u9f4a\u5168","\u5916\u6bbc","\u6c34\u5668","MP3","\u5679\u5679"],"x":{"__ndarray__":"y+d8QEpyLkGN8R9BhIInQbPfA0FfRCRBRljsQDRHEkGG5ixBKWMRQX0wXUDsohdBPxrnQIuyFkFsTwdBBTIbQQX6ukCWlxtBDo+MQA2j2UDrJQNByc31QOkJD0FEXbFArMhCQDmdzkAAnLRAja4NQTXMuEBRurBAvQ2eQDGtz0C3F9NAA+qLP8FsjD3804c/QBjIQCNCzL5FKdtAbRPCP93+qkBwHUNAGRrLQCsXIEBqaSNAHJ+2QKLgvUB663w/UJk3P5dOjUC4ctC+OKOvQAJDj0DxTWZACBAzQOLigUBPado/2A7kP+1pjUCL7JS/4ayBQBDsaD4FTYFAU6q2P/RQhsByNd6/J5ovv3TNFr/sMtu9lQ6/wFZXmMDzx9i/Ac6awC71JcHWT3NAyVeaP7HyYz5SqZTANjKRP98tRcD3qXs/7NCuwCGPV78iQM/AtMZBv9Tyt8BWvpfAtrFhwOsopj9QB889/oC6wD8PN8AF8RTBnEbMwJAvEcCnsEC/PfzCv+w50j90MIM/oTrhwG7aFMEaMSrBH/4ywSpCZMAhKPK+qkc1v3xFtcAUy8XAeSoZwbeJE8Ep1gLBhbewwJlP1cBSUrq/8Krbv2zn8cC8JOPA6/Y2wWFqAcGrcCXBoZ7ZwLc9UcAh1rfAVZ6IwJhzP8CWBbbAgnIbwXqEPcHEjCLBsjchwf+AocDcD6bAehwXwXQVC8GxWh3B3/gHwew/IsD0JyrB4VoHwbgyBME7LfPAaYUXwWTEMcH39RvBAa41wVGcHsFExBDBt0WywCtIMMHDTjPB","dtype":"float32","order":"little","shape":[150]},"y":{"__ndarray__":"jK7jQNj7uEB7scpAYTrTQPkkzkCq7qhAdZzZQAlGoUAqaJ5ApK64QJhloEAdS6BAhu/eQFjxw0DXE6hAgn2LQCGnykCiJoVA17mwQEEBr0DieY5Ap224QPygj0A3OsRAetmvQC1BYUANKoFAbYp/QCwOQUDNAyNAG+BdQCrCqj/KEZ1AjIm7QG/kpL5LdLtAQGVJP8zF3z+U0UZAq7W6QAXWBkB8tnRAvd2MQIXZUT+oDIo+kmkbPxlSpT/RW3jAgjeTP1R51L/43X8/SLSBvUjfpT9Bfg9AnF7JP1hM2b8y6OK+Sqc/wCv8ckCIaRzAxG5IQBH6J8DUQhtAgypOwJFO8MBilinAyNXev1scfL/k8YXAZeW5wO1598BdEoa/HpIKwXC7sMCZ/ltA9IMZwIXjyj7IIIjAejPIPxBDo8AelUzATfn1wLldCT8tBAvBK1ciPeXEr8B5iLHAd+jUwHFQjb7PNkzAInU+wNH2kMAYXhfBCgsCwedbIcAW4HbAw5S3v4Hk3z49UW+/EZrpwIBrK8Hru+7AeCXiwGTapcBtvXTA9geYwFetF8GHPZjA5l4dwZHZycB6ms3Ae6tWwNTEIcGpVey/lKRowAxG/cCMfBTB2drKwJQ5GcHEttrA4Y+jwBvcO8DzWL/AOodzwM0Wf8DAr7S/Q7vIwIZqzcDHSwzByR4cwbz/QsBJdXfAAQS3wIdT1cDabPHAM/O5wBCrScBZn9TAeBojwQXLDMGNXQ7Br1z2wDOy/cDDYNrASSEOwe9bK8FYgdzAyl6lwC3aGME/x7zA","dtype":"float32","order":"little","shape":[150]}},"selected":{"id":"1056"},"selection_policy":{"id":"1055"}},"id":"1042","type":"ColumnDataSource"},{"attributes":{"bottom_units":"screen","coordinates":null,"fill_alpha":0.5,"fill_color":"lightgrey","group":null,"left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","syncable":false,"top_units":"screen"},"id":"1028","type":"BoxAnnotation"},{"attributes":{"source":{"id":"1036"}},"id":"1041","type":"CDSView"},{"attributes":{"tools":[{"id":"1022"},{"id":"1023"},{"id":"1024"},{"id":"1025"},{"id":"1026"},{"id":"1027"}]},"id":"1029","type":"Toolbar"},{"attributes":{},"id":"1012","type":"LinearScale"},{"attributes":{},"id":"1055","type":"UnionRenderers"},{"attributes":{"data":{"x":{"__ndarray__":"y+d8QEpyLkGN8R9BhIInQbPfA0FfRCRBRljsQDRHEkGG5ixBKWMRQX0wXUDsohdBPxrnQIuyFkFsTwdBBTIbQQX6ukCWlxtBDo+MQA2j2UDrJQNByc31QOkJD0FEXbFArMhCQDmdzkAAnLRAja4NQTXMuEBRurBAvQ2eQDGtz0C3F9NAA+qLP8FsjD3804c/QBjIQCNCzL5FKdtAbRPCP93+qkBwHUNAGRrLQCsXIEBqaSNAHJ+2QKLgvUB663w/UJk3P5dOjUC4ctC+OKOvQAJDj0DxTWZACBAzQOLigUBPado/2A7kP+1pjUCL7JS/4ayBQBDsaD4FTYFAU6q2P/RQhsByNd6/J5ovv3TNFr/sMtu9lQ6/wFZXmMDzx9i/Ac6awC71JcHWT3NAyVeaP7HyYz5SqZTANjKRP98tRcD3qXs/7NCuwCGPV78iQM/AtMZBv9Tyt8BWvpfAtrFhwOsopj9QB889/oC6wD8PN8AF8RTBnEbMwJAvEcCnsEC/PfzCv+w50j90MIM/oTrhwG7aFMEaMSrBH/4ywSpCZMAhKPK+qkc1v3xFtcAUy8XAeSoZwbeJE8Ep1gLBhbewwJlP1cBSUrq/8Krbv2zn8cC8JOPA6/Y2wWFqAcGrcCXBoZ7ZwLc9UcAh1rfAVZ6IwJhzP8CWBbbAgnIbwXqEPcHEjCLBsjchwf+AocDcD6bAehwXwXQVC8GxWh3B3/gHwew/IsD0JyrB4VoHwbgyBME7LfPAaYUXwWTEMcH39RvBAa41wVGcHsFExBDBt0WywCtIMMHDTjPB","dtype":"float32","order":"little","shape":[150]},"y":{"__ndarray__":"jK7jQNj7uEB7scpAYTrTQPkkzkCq7qhAdZzZQAlGoUAqaJ5ApK64QJhloEAdS6BAhu/eQFjxw0DXE6hAgn2LQCGnykCiJoVA17mwQEEBr0DieY5Ap224QPygj0A3OsRAetmvQC1BYUANKoFAbYp/QCwOQUDNAyNAG+BdQCrCqj/KEZ1AjIm7QG/kpL5LdLtAQGVJP8zF3z+U0UZAq7W6QAXWBkB8tnRAvd2MQIXZUT+oDIo+kmkbPxlSpT/RW3jAgjeTP1R51L/43X8/SLSBvUjfpT9Bfg9AnF7JP1hM2b8y6OK+Sqc/wCv8ckCIaRzAxG5IQBH6J8DUQhtAgypOwJFO8MBilinAyNXev1scfL/k8YXAZeW5wO1598BdEoa/HpIKwXC7sMCZ/ltA9IMZwIXjyj7IIIjAejPIPxBDo8AelUzATfn1wLldCT8tBAvBK1ciPeXEr8B5iLHAd+jUwHFQjb7PNkzAInU+wNH2kMAYXhfBCgsCwedbIcAW4HbAw5S3v4Hk3z49UW+/EZrpwIBrK8Hru+7AeCXiwGTapcBtvXTA9geYwFetF8GHPZjA5l4dwZHZycB6ms3Ae6tWwNTEIcGpVey/lKRowAxG/cCMfBTB2drKwJQ5GcHEttrA4Y+jwBvcO8DzWL/AOodzwM0Wf8DAr7S/Q7vIwIZqzcDHSwzByR4cwbz/QsBJdXfAAQS3wIdT1cDabPHAM/O5wBCrScBZn9TAeBojwQXLDMGNXQ7Br1z2wDOy/cDDYNrASSEOwe9bK8FYgdzAyl6lwC3aGME/x7zA","dtype":"float32","order":"little","shape":[150]}},"selected":{"id":"1053"},"selection_policy":{"id":"1052"}},"id":"1036","type":"ColumnDataSource"},{"attributes":{"coordinates":null,"group":null,"source":{"id":"1042"},"text":{"field":"label"},"x":{"field":"x"},"x_offset":{"value":5},"y":{"field":"y"},"y_offset":{"value":5}},"id":"1043","type":"LabelSet"},{"attributes":{},"id":"1010","type":"LinearScale"},{"attributes":{"coordinates":null,"formatter":{"id":"1050"},"group":null,"major_label_policy":{"id":"1051"},"ticker":{"id":"1015"}},"id":"1014","type":"LinearAxis"},{"attributes":{},"id":"1056","type":"Selection"},{"attributes":{},"id":"1051","type":"AllLabels"},{"attributes":{},"id":"1006","type":"DataRange1d"},{"attributes":{"fill_alpha":{"value":0.2},"fill_color":{"value":"#1f77b4"},"hatch_alpha":{"value":0.2},"line_alpha":{"value":0.2},"line_color":{"value":"#1f77b4"},"size":{"value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1039","type":"Circle"},{"attributes":{},"id":"1052","type":"UnionRenderers"},{"attributes":{"overlay":{"id":"1028"}},"id":"1024","type":"BoxZoomTool"},{"attributes":{},"id":"1050","type":"BasicTickFormatter"},{"attributes":{},"id":"1053","type":"Selection"},{"attributes":{"fill_alpha":{"value":0.2},"fill_color":{"value":"#1f77b4"},"line_color":{"value":"#1f77b4"},"size":{"value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1037","type":"Circle"}],"root_ids":["1003"]},"title":"Bokeh Application","version":"2.4.2"}};
  const render_items = [{"docid":"ce64a561-b0ad-4b70-b35e-3c08e1ac615d","root_ids":["1003"],"roots":{"1003":"90b8b751-ed51-4354-a7d2-60be9c4eab8f"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
</section>
</section>
<section id="doc-clustering-with-embeddings">
<h2>Doc clustering with embeddings<a class="headerlink" href="#doc-clustering-with-embeddings" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://medium.com/datamixcontent-lab/%E8%B3%87%E6%96%99%E5%88%86%E6%9E%90%E5%B8%AB%E8%87%AA%E5%AD%B8%E7%AD%86%E8%A8%98-%E6%A6%82%E5%BF%B5-%E5%AF%A6%E4%BD%9C%E7%AF%87-%E8%87%AA%E7%84%B6%E8%AA%9E%E8%A8%80%E8%99%95%E7%90%86%E5%85%A5%E9%96%80-%E4%B9%8B-word2vec-doc2vec-%E6%AF%94%E8%BC%83-c94dd0a407c7">【資料分析概念大全｜認識文本分析】Word2Vec, Doc2Vec 比較 (附Python程式碼)</a></p></li>
</ul>
<section id="sum-up-wordvec-to-docvec">
<h3>Sum up wordvec to docvec<a class="headerlink" href="#sum-up-wordvec-to-docvec" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tag</th>
      <th>text</th>
      <th>token_text</th>
      <th>cleaned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P</td>
      <td>店家很給力，快遞也是相當快，第三次光顧啦</td>
      <td>[店家, 很, 給力, ，, 快遞, 也, 是, 相當快, ，, 第三次, 光顧, 啦]</td>
      <td>[店家, 給力, 快遞, 相當快, 第三次, 光顧]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N</td>
      <td>這樣的配置用Vista系統還是有點卡。 指紋收集器。 沒送原裝滑鼠還需要自己買，不太好。</td>
      <td>[這樣, 的, 配置, 用, Vista, 系統, 還是, 有點, 卡, 。,  , 指紋,...</td>
      <td>[配置, Vista, 系統, 有點, 卡, 指紋, 收集器, 沒送, 原裝, 滑鼠, 需要...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P</td>
      <td>不錯，在同等檔次酒店中應該是值得推薦的！</td>
      <td>[不錯, ，, 在, 同等, 檔次, 酒店, 中應, 該, 是, 值得, 推薦, 的, ！]</td>
      <td>[不錯, 同等, 檔次, 酒店, 中應, 值得, 推薦]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>N</td>
      <td>哎！ 不會是蒙牛乾的吧 嚴懲真凶！</td>
      <td>[哎, ！,  , 不會, 是, 蒙牛, 乾, 的, 吧,  , 嚴懲, 真凶, ！]</td>
      <td>[蒙牛, 乾, 嚴懲, 真凶]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>N</td>
      <td>空尤其是三立電視臺女主播做的序尤其無趣像是硬湊那麼多字</td>
      <td>[空, 尤其, 是, 三立, 電視, 臺, 女主播, 做, 的, 序, 尤其, 無趣, 像是...</td>
      <td>[空, 尤其, 三立, 電視, 臺, 女主播, 做, 序, 尤其, 無趣, 像是, 硬, 湊...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6383</th>
      <td>P</td>
      <td>價效比高、記憶體大、功能全，螢幕超清晰</td>
      <td>[價效, 比高, 、, 記憶體, 大, 、, 功能, 全, ，, 螢幕超, 清晰]</td>
      <td>[價效, 比高, 記憶體, 功能, 全, 螢幕超, 清晰]</td>
    </tr>
    <tr>
      <th>6384</th>
      <td>N</td>
      <td>你太狠了… 告訴你他們不會喧譁的人，肯定是蒙牛喝多了</td>
      <td>[你, 太狠, 了, …,  , 告訴, 你, 他們, 不會, 喧, 譁, 的, 人, ，,...</td>
      <td>[太狠, 告訴, 喧, 譁, 人, 肯定, 蒙牛, 喝多]</td>
    </tr>
    <tr>
      <th>6385</th>
      <td>N</td>
      <td>醫生居然買了蒙牛，我是喝呢還是不喝呢還是不喝呢？</td>
      <td>[ , 醫生, 居然, 買, 了, 蒙牛, ，, 我, 是, 喝, 呢, 還是, 不, 喝,...</td>
      <td>[醫生, 買, 蒙牛, 喝, 喝, 喝]</td>
    </tr>
    <tr>
      <th>6386</th>
      <td>N</td>
      <td>我只想說 夾蒙牛是不對的 販賣毒品是犯罪行為</td>
      <td>[我, 只, 想, 說,  , 夾, 蒙牛, 是, 不, 對, 的,  , 販賣, 毒品, ...</td>
      <td>[只, 想, 說, 夾, 蒙牛, 販賣, 毒品, 犯罪, 行為]</td>
    </tr>
    <tr>
      <th>6387</th>
      <td>P</td>
      <td>蒙牛便宜</td>
      <td>[蒙牛, 便宜]</td>
      <td>[蒙牛, 便宜]</td>
    </tr>
  </tbody>
</table>
<p>6388 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Counter</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;cleaned&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Counter({6: 416,
         13: 511,
         7: 438,
         4: 278,
         14: 426,
         8: 442,
         2: 182,
         12: 565,
         17: 162,
         15: 340,
         10: 526,
         9: 530,
         11: 535,
         16: 265,
         5: 315,
         3: 242,
         19: 42,
         1: 50,
         23: 1,
         18: 91,
         20: 19,
         0: 4,
         21: 5,
         32: 1,
         22: 2})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">all_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># for tokens in df[&quot;cleaned&quot;]:</span>
<span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;token_text&quot;</span><span class="p">]:</span>
    <span class="n">temp_w2v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
    <span class="c1"># if len(tokens) == 0:</span>
    <span class="c1">#     all_list.append(temp_w2v)</span>
    <span class="c1">#     continue</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">:</span>  <span class="c1"># Check if the token is in the model</span>
            <span class="n">temp_w2v</span> <span class="o">+=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="p">[</span><span class="n">tok</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">temp_w2v</span> <span class="o">/=</span> <span class="n">count</span>  <span class="c1"># Averaging</span>
    <span class="n">all_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_w2v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">temp_w2v</span><span class="p">))</span>  <span class="c1"># Normalizing</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6388
</pre></div>
</div>
</div>
</div>
<section id="convert-to-numpy-array">
<h4>Convert to numpy array<a class="headerlink" href="#convert-to-numpy-array" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_list</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6388, 300)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reduce-dimension-by-tsne">
<h3>Reduce dimension by tsne<a class="headerlink" href="#reduce-dimension-by-tsne" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
            <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
            <span class="n">init</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,)</span>
<span class="n">tsne_embeddings</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> 
<span class="c1"># points_tsne[:10].shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jirlong/opt/anaconda3/lib/python3.9/site-packages/sklearn/manifold/_t_sne.py:790: FutureWarning: The default learning rate in TSNE will change from 200.0 to &#39;auto&#39; in 1.2.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
</section>
<section id="reduce-dimension-by-umap">
<h3>Reduce dimension by umap<a class="headerlink" href="#reduce-dimension-by-umap" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install umap-learn</span>
<span class="kn">import</span> <span class="nn">umap</span>
<span class="c1"># X = np.where(np.isinf(X), np.finfo(np.float32).max, X)</span>
<span class="n">umap_embeddings</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> 
                            <span class="n">n_components</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                            <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">umap_embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6388
</pre></div>
</div>
</div>
</div>
</section>
<section id="clustering-by-hdbscan">
<h3>Clustering by hdbscan<a class="headerlink" href="#clustering-by-hdbscan" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">gini_coefficient</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">counts</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">index</span> <span class="o">-</span> <span class="n">n</span>  <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">counts</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)))</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span>

<span class="k">def</span> <span class="nf">calculate_entropy</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">entropy</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">variance_of_proportions</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">proportions</span> <span class="o">=</span> <span class="p">[</span><span class="n">count</span> <span class="o">/</span> <span class="n">total</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">proportions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">imbalance_ratio</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">coefficient_of_variation</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install hdbscan</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">hdbscan</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">unclustered_ratio</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">n_clusters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ginis</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">entropies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">K</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">K</span><span class="p">:</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span>
        <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>                      
        <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tsne_embeddings</span><span class="p">)</span>
    
    <span class="n">cluster_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">labels_</span><span class="p">))</span>
    <span class="n">unclustered_ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">tsne_embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">n_clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_counter</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ginis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gini_coefficient</span><span class="p">(</span><span class="n">cluster_counter</span><span class="p">))</span>
    <span class="n">entropies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_entropy</span><span class="p">(</span><span class="n">cluster_counter</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="p">[</span><span class="n">r</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unclustered_ratio</span><span class="p">],</span> <span class="s1">&#39;bx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ginis</span><span class="p">,</span> <span class="s1">&#39;gx-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gini&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">*</span><span class="mi">10</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entropies</span><span class="p">],</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;entropy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;uncluster_rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5 6 7 8 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9 10 11 12 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13 14 15 16 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17 18 19 20 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>21 22 23 24 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25 26 27 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28 29 30 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>31 32 33 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>34 35 36 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37 38 39 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>40 41 42 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>43 44 45 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46 47 48 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>49 50 51 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>52 53 54 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>55 56 57 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>58 59 60 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>61 62 63 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>64 65 66 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>67 68 69 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>70 71 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>72 73 74 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>75 76 77 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>78 79 80 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>81 82 83 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>84 85 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>86 87 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>88 89 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>90 91 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>92 93 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>94 95 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>96 97 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>98 99 
</pre></div>
</div>
<img alt="../_images/c9235edad5fa368b81fed542825b26fdf3aafcd6056fd69a0ada6ab432bc9d9b.png" src="../_images/c9235edad5fa368b81fed542825b26fdf3aafcd6056fd69a0ada6ab432bc9d9b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="p">[</span><span class="n">u</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">unclustered_ratio</span><span class="p">],</span> <span class="s1">&#39;bx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ginis</span><span class="p">,</span> <span class="s1">&#39;gx-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gini&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span><span class="o">*</span><span class="mi">10</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entropies</span><span class="p">],</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;entropy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;uncluster_rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/67063ecd9ae8532143856259fe3242472f4c20bef2cf0257e41e4fd40e94384a.png" src="../_images/67063ecd9ae8532143856259fe3242472f4c20bef2cf0257e41e4fd40e94384a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install hdbscan</span>
<span class="kn">import</span> <span class="nn">hdbscan</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span>
    <span class="n">min_cluster_size</span><span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>                      
    <span class="n">cluster_selection_method</span><span class="o">=</span><span class="s1">&#39;eom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tsne_embeddings</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;tag&#39;, &#39;text&#39;, &#39;token_text&#39;, &#39;cleaned&#39;, &#39;cluster&#39;], dtype=&#39;object&#39;)
Counter({4: 4984, 2: 715, 1: 326, -1: 159, 0: 117, 3: 60, 5: 27})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tag</th>
      <th>text</th>
      <th>token_text</th>
      <th>cleaned</th>
      <th>cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P</td>
      <td>店家很給力，快遞也是相當快，第三次光顧啦</td>
      <td>[店家, 很, 給力, ，, 快遞, 也, 是, 相當快, ，, 第三次, 光顧, 啦]</td>
      <td>[店家, 給力, 快遞, 相當快, 第三次, 光顧]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N</td>
      <td>這樣的配置用Vista系統還是有點卡。 指紋收集器。 沒送原裝滑鼠還需要自己買，不太好。</td>
      <td>[這樣, 的, 配置, 用, Vista, 系統, 還是, 有點, 卡, 。,  , 指紋,...</td>
      <td>[配置, Vista, 系統, 有點, 卡, 指紋, 收集器, 沒送, 原裝, 滑鼠, 需要...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P</td>
      <td>不錯，在同等檔次酒店中應該是值得推薦的！</td>
      <td>[不錯, ，, 在, 同等, 檔次, 酒店, 中應, 該, 是, 值得, 推薦, 的, ！]</td>
      <td>[不錯, 同等, 檔次, 酒店, 中應, 值得, 推薦]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>N</td>
      <td>哎！ 不會是蒙牛乾的吧 嚴懲真凶！</td>
      <td>[哎, ！,  , 不會, 是, 蒙牛, 乾, 的, 吧,  , 嚴懲, 真凶, ！]</td>
      <td>[蒙牛, 乾, 嚴懲, 真凶]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>N</td>
      <td>空尤其是三立電視臺女主播做的序尤其無趣像是硬湊那麼多字</td>
      <td>[空, 尤其, 是, 三立, 電視, 臺, 女主播, 做, 的, 序, 尤其, 無趣, 像是...</td>
      <td>[空, 尤其, 三立, 電視, 臺, 女主播, 做, 序, 尤其, 無趣, 像是, 硬, 湊...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6383</th>
      <td>P</td>
      <td>價效比高、記憶體大、功能全，螢幕超清晰</td>
      <td>[價效, 比高, 、, 記憶體, 大, 、, 功能, 全, ，, 螢幕超, 清晰]</td>
      <td>[價效, 比高, 記憶體, 功能, 全, 螢幕超, 清晰]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6384</th>
      <td>N</td>
      <td>你太狠了… 告訴你他們不會喧譁的人，肯定是蒙牛喝多了</td>
      <td>[你, 太狠, 了, …,  , 告訴, 你, 他們, 不會, 喧, 譁, 的, 人, ，,...</td>
      <td>[太狠, 告訴, 喧, 譁, 人, 肯定, 蒙牛, 喝多]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6385</th>
      <td>N</td>
      <td>醫生居然買了蒙牛，我是喝呢還是不喝呢還是不喝呢？</td>
      <td>[ , 醫生, 居然, 買, 了, 蒙牛, ，, 我, 是, 喝, 呢, 還是, 不, 喝,...</td>
      <td>[醫生, 買, 蒙牛, 喝, 喝, 喝]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6386</th>
      <td>N</td>
      <td>我只想說 夾蒙牛是不對的 販賣毒品是犯罪行為</td>
      <td>[我, 只, 想, 說,  , 夾, 蒙牛, 是, 不, 對, 的,  , 販賣, 毒品, ...</td>
      <td>[只, 想, 說, 夾, 蒙牛, 販賣, 毒品, 犯罪, 行為]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6387</th>
      <td>P</td>
      <td>蒙牛便宜</td>
      <td>[蒙牛, 便宜]</td>
      <td>[蒙牛, 便宜]</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
<p>6388 rows × 5 columns</p>
</div></div></div>
</div>
</section>
<section id="id1">
<h3>Plotting<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Prepare data</span>
<span class="c1"># Reduce original data to two dimensions</span>
<span class="n">umap_data</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
    <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Combine x and y and cluster label</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">umap_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">result</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">labels_</span>

<span class="c1"># Visualize clusters</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">clustered</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">outliers</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">outliers</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#BDBDBD&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">clustered</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">clustered</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">clustered</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hsv_r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x2a1b2a3a0&gt;
</pre></div>
</div>
<img alt="../_images/fd93111ae7f1f52c43cb5e18c2354dcef0ad36e23852bb994899822fa67d5a8a.png" src="../_images/fd93111ae7f1f52c43cb5e18c2354dcef0ad36e23852bb994899822fa67d5a8a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unicodedata</span> <span class="c1"># for removing Chinese puctuation</span>
<span class="c1"># !wget https://github.com/P4CSS/PSS/raw/master/data/stopwords_zh-tw.txt -O stopwords_zh-tw.txt</span>
<span class="k">def</span> <span class="nf">remove_stopWords</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;stopwords_zh-tw.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
        <span class="n">stopwords</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
<span class="k">def</span> <span class="nf">remove_punc_by_unicode</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;token_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">remove_punc_by_unicode</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">remove_stopWords</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">Counter</span>
<span class="n">clu_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">])</span>
<span class="n">cdict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cleaned&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="n">cdict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cdict</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;has&quot;</span><span class="p">,</span> <span class="n">clu_counter</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="s2">&quot;members&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cdict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------------------
Cluster 4 has 4984 members
[(&#39;蒙牛&#39;, 1059), (&#39;好&#39;, 916), (&#39;不錯&#39;, 750), (&#39;買&#39;, 470), (&#39;說&#39;, 341), (&#39;酒店&#39;, 328), (&#39;房間&#39;, 309), (&#39;感覺&#39;, 299), (&#39;系統&#39;, 227), (&#39;外觀&#39;, 226), (&#39;喝&#39;, 224), (&#39;方便&#39;, 214), (&#39;書&#39;, 214), (&#39;價效&#39;, 213), (&#39;價格&#39;, 211), (&#39;後&#39;, 209), (&#39;喜歡&#39;, 203), (&#39;螢幕&#39;, 197), (&#39;太&#39;, 190), (&#39;有點&#39;, 189)]
--------------------------------------------------------------------------------
Cluster 2 has 715 members
[(&#39;好&#39;, 160), (&#39;不錯&#39;, 115), (&#39;蒙牛&#39;, 87), (&#39;買&#39;, 80), (&#39;說&#39;, 60), (&#39;外觀&#39;, 44), (&#39;價格&#39;, 42), (&#39;酒店&#39;, 41), (&#39;有點&#39;, 37), (&#39;書&#39;, 36), (&#39;質量&#39;, 34), (&#39;問題&#39;, 34), (&#39;速度&#39;, 33), (&#39;服務&#39;, 33), (&#39;感覺&#39;, 33), (&#39;後&#39;, 33), (&#39;系統&#39;, 32), (&#39;一個&#39;, 31), (&#39;螢幕&#39;, 31), (&#39;漂亮&#39;, 31)]
--------------------------------------------------------------------------------
Cluster 1 has 326 members
[(&#39;蒙牛&#39;, 333), (&#39;喝&#39;, 76), (&#39;抵制&#39;, 45), (&#39;買&#39;, 28), (&#39;伊利&#39;, 26), (&#39;太&#39;, 20), (&#39;牛奶&#39;, 17), (&#39;遠離&#39;, 15), (&#39;厚&#39;, 15), (&#39;轉發&#39;, 13), (&#39;好&#39;, 13), (&#39;酸奶&#39;, 12), (&#39;企業&#39;, 12), (&#39;後&#39;, 11), (&#39;支援&#39;, 11), (&#39;早就&#39;, 10), (&#39;喜歡&#39;, 10), (&#39;哈哈哈&#39;, 10), (&#39;生命&#39;, 9), (&#39;知道&#39;, 9)]
--------------------------------------------------------------------------------
Cluster 3 has 60 members
[(&#39;好&#39;, 38), (&#39;不錯&#39;, 15), (&#39;配置&#39;, 14), (&#39;外觀&#39;, 11), (&#39;價效&#39;, 10), (&#39;螢幕&#39;, 10), (&#39;鍵盤&#39;, 8), (&#39;散熱&#39;, 7), (&#39;高&#39;, 7), (&#39;速度&#39;, 6), (&#39;房間&#39;, 6), (&#39;比較&#39;, 6), (&#39;實用&#39;, 6), (&#39;酒店&#39;, 6), (&#39;滿意&#39;, 6), (&#39;服務&#39;, 5), (&#39;本本&#39;, 5), (&#39;喜歡&#39;, 5), (&#39;比高&#39;, 5), (&#39;還不錯&#39;, 4)]
--------------------------------------------------------------------------------
Cluster -1 has 159 members
[(&#39;好&#39;, 42), (&#39;蒙牛&#39;, 24), (&#39;不錯&#39;, 18), (&#39;房間&#39;, 18), (&#39;螢幕&#39;, 14), (&#39;有點&#39;, 10), (&#39;說&#39;, 10), (&#39;感覺&#39;, 10), (&#39;外觀&#39;, 9), (&#39;酒店&#39;, 9), (&#39;抵制&#39;, 9), (&#39;支援&#39;, 9), (&#39;價格&#39;, 8), (&#39;功能&#39;, 8), (&#39;效果&#39;, 8), (&#39;環境&#39;, 7), (&#39;太&#39;, 7), (&#39;設施&#39;, 7), (&#39;服務&#39;, 7), (&#39;比較&#39;, 7)]
--------------------------------------------------------------------------------
Cluster 0 has 117 members
[(&#39;蒙牛&#39;, 53), (&#39;好&#39;, 18), (&#39;買&#39;, 13), (&#39;書&#39;, 11), (&#39;說&#39;, 10), (&#39;喝&#39;, 9), (&#39;喜歡&#39;, 8), (&#39;牛奶&#39;, 7), (&#39;不錯&#39;, 6), (&#39;電池&#39;, 5), (&#39;新&#39;, 5), (&#39;好吃&#39;, 5), (&#39;一個&#39;, 5), (&#39;知道&#39;, 5), (&#39;價格&#39;, 4), (&#39;中&#39;, 4), (&#39;不到&#39;, 4), (&#39;香蕉&#39;, 4), (&#39;奶特&#39;, 4), (&#39;再&#39;, 4)]
--------------------------------------------------------------------------------
Cluster 5 has 27 members
[(&#39;支援&#39;, 10), (&#39;系統&#39;, 5), (&#39;聲音&#39;, 4), (&#39;螢幕&#39;, 4), (&#39;MP3&#39;, 4), (&#39;顯示&#39;, 3), (&#39;有點&#39;, 3), (&#39;方便&#39;, 3), (&#39;介面&#39;, 3), (&#39;電池&#39;, 3), (&#39;時間&#39;, 3), (&#39;效果&#39;, 3), (&#39;後&#39;, 3), (&#39;光碟&#39;, 3), (&#39;太&#39;, 3), (&#39;功能&#39;, 2), (&#39;齊全&#39;, 2), (&#39;外觀&#39;, 2), (&#39;時&#39;, 2), (&#39;VISTA&#39;, 2)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Number of columns for subplots</span>
<span class="n">num_columns</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Total number of clusters</span>
<span class="n">num_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clu_counter</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Calculate the number of rows needed</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">num_clusters</span> <span class="o">//</span> <span class="n">num_columns</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_clusters</span> <span class="o">%</span> <span class="n">num_columns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create a figure with subplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">num_columns</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">num_rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="k">for</span> <span class="n">clu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">):</span>
    <span class="c1"># Create a subplot in the appropriate grid position</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">,</span> <span class="n">clu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create a DataFrame for the current cluster</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cdict</span><span class="p">[</span><span class="n">clu</span><span class="p">]</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">])</span>
    
    <span class="c1"># Sort the data</span>
    <span class="n">df_data</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Plot the data</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">)</span>

    <span class="c1"># Optionally, add a title for each subplot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">clu</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Adjust the layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2d33b0d57a922c83c9f9fbd3b41de09b4fa92166f19e09c17eba7a7e63ff31d7.png" src="../_images/2d33b0d57a922c83c9f9fbd3b41de09b4fa92166f19e09c17eba7a7e63ff31d7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import seaborn as sns</span>
<span class="sd">for clu in range(len(clu_counter)-1):</span>
<span class="sd">    df1 = pd.DataFrame(list(cdict[clu].most_common(20)), columns = [&#39;word&#39;, &#39;n&#39;])</span>
<span class="sd">    plt.figure(figsize=(6, 4), dpi=150) </span>
<span class="sd">    df_data = df1.sort_values(&#39;n&#39;, ascending=False)</span>
<span class="sd">#     print(df_data)</span>
<span class="sd">    sns.barplot(x=&#39;n&#39;, </span>
<span class="sd">                y=&#39;word&#39;, </span>
<span class="sd">                data=df_data, </span>
<span class="sd">                label=&#39;word&#39;, </span>
<span class="sd">                color=&#39;royalblue&#39;,</span>
<span class="sd">               )</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;\nimport seaborn as sns\nfor clu in range(len(clu_counter)-1):\n    df1 = pd.DataFrame(list(cdict[clu].most_common(20)), columns = [&#39;word&#39;, &#39;n&#39;])\n    plt.figure(figsize=(6, 4), dpi=150) \n    df_data = df1.sort_values(&#39;n&#39;, ascending=False)\n#     print(df_data)\n    sns.barplot(x=&#39;n&#39;, \n                y=&#39;word&#39;, \n                data=df_data, \n                label=&#39;word&#39;, \n                color=&#39;royalblue&#39;,\n               )\n&quot;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./TM"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="TM06_Clustering.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">TM06 Clustering</p>
      </div>
    </a>
    <a class="right-next"
       href="TM07_2_doc2vec.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">TM07 word2vec vs doc2vec</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目錄
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process">Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#term-frequency">Term frequency</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-stopwords">Loading stopwords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-chinese-punctuation">Detecting Chinese punctuation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-word2vec-model">Building word2vec model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-model">Building model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-similarity">Testing Similarity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualized-with-dimension-reduction">Visualized with Dimension reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-top-150-to-visualize">Retrieve top 150 to visualize</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-by-pca">Reduced by PCA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduced-by-t-sne">Reduced by t-SNE</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">Plotting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-by-matplotlib-or-seaborn">Plot by matplotlib or seaborn</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-by-bokeh">plot by bokeh</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#doc-clustering-with-embeddings">Doc clustering with embeddings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sum-up-wordvec-to-docvec">Sum up wordvec to docvec</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-numpy-array">Convert to numpy array</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduce-dimension-by-tsne">Reduce dimension by tsne</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduce-dimension-by-umap">Reduce dimension by umap</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustering-by-hdbscan">Clustering by hdbscan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Plotting</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
作者： JILUNG
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>


<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>TM02 Collocation &#8212; Programming for Social Scientists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/.ipynb_checkpoints/custom-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'TM/TM02_collocation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TM03 POS Tagging" href="TM03_POS%20Tagging.html" />
    <link rel="prev" title="Chinese Processing" href="TM01_tokenization%28chi%29.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Programming for Social Scientists
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Logic</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P01_counting.html">P01-Counting</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P01p_counting.html">P01-Practice</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P02_0_basic.html">P02-Python Basic</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P02p_basic.html">Practices 02 for Python basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P02_2_exceptions.html">Exceptions(Errors) Handling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P03_list_dictionary.html">P03-List and Dictionary</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P03p.html">P03 Practice: Accessing dict and list</a></li>

<li class="toctree-l2"><a class="reference internal" href="../PSS/P03p_ans.html">P03 Practice: Accessing dict and list</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P04_for.html">P04 Flow Control</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p1_for.html">P04 Practice01: for loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p2_search_maximum.html">P04 Practice02 Search &amp; Maximum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P04p3_twitter_users.html">P04 Practice03 Twitter Users</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P05_read_csv_json.html">P05 READ Files</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p1_read_csv.html">P05-1 Read CSV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p2_read_json.html">P05-2 Load and dump ubike json data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P05p3_read_other_format.html">Read more formats</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P06_pandas.html">P06 Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p1_summarizing.html">Pandas: Counting and Summarizing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p2_filter_select_datetime.html">Pandas: filter, select, and timeline process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P06p3_timestamp.html">P06-3 Processing timestamp</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P07_0_visualization.html">P07 Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P07_1_plot_pandas.html">Making Charts with Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P07_2_bokeh.html">Bokeh &amp; Seaborn(Vaccinating)</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Acquisition</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../PSS/P08_0_scraper.html">P08 Web Crawler</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_1_web_json.html">Web API: cnyes &amp; 104.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_2_twitter_api.html">Twitter API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_3%20tweepy.html">Tweepy for twitter API 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PSS/P08_5_cases.html">Scraping cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../PSS/P08_4_ptt_crawler.html">P08 HTML Parsing - Crawling PTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PSS/P09_database.html">P09 Database</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Mining</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="TM01_tokenization.html">TM01 Tokenization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="TM01_tokenization%28chi%29.html">Chinese Processing</a></li>





</ul>
</li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">TM02 Collocation</a></li>

<li class="toctree-l1"><a class="reference internal" href="TM03_POS%20Tagging.html">TM03 POS Tagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM04_IR_search.html">TM04 Feature Selection &amp; IR &amp; Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM05_sentiment.html">TM05 Sentiment analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="TM06_Clustering.html">TM06 Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM07_embedding_clustering.html">TM07 embedding and clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM07_2_doc2vec.html">TM07 word2vec vs doc2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM08_doc_classification.html">TM08 Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM09_BERTopic.html">TM09 Topic Modeling by BERtopic</a></li>
<li class="toctree-l1"><a class="reference internal" href="TM10_Using_Open_AI.html">TM10 Using Open AI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using deep learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/drive/1pXfdPEQDY5wDhlzjr867duFsAVAXj5Yz?usp=sharing">Transformer-Clusteirng</a></li>
<li class="toctree-l1"><a class="reference external" href="https://colab.research.google.com/drive/1YD8mjrpEH6-0rYMY0L1xFFKpJ2jGY6nT?usp=share_link">Transformer-Classification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Compuational Social Science</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../CSS/CSS01_network_analysis.html">CSS01 Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CSS/CSS02_Simulation.html">CSS02 Simulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../AS/AS01_basic.html">PART I: Trivial Question with AI</a></li>


<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_ptt_jsonl.html">AS02 Reading PTT data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_ptt_jsonl_ans.html">AS02 Reading PTT data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS02_list_dict_for_if.html">AS02 List-dict-for-if</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS03_summarize_ptt.html">AS03: Summarizing Data by Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS03_pandas_summarization.html">AS03 Summarize data with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS04_vis_twitter_api.html">AS04 Twitter API and Pandas Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS05_scraping_youtube.html">AS05 Scraping youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS05_Scraping_youtube_with_chatGPT.html">AS05. Improving Youtube Scraper with ChatGPT</a></li>




<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1L9coxxzKsy7_KzrBWno6Jh9zY785AtJB/view?usp=sharing">AS06 Tokenization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS06_Tokenization.html">AS06 - Tokenization and keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS07_collocation.html">AS07 Collocation for finding enthusiastic commentors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS08_clustering_yt_comment.html">AS08 Youtube comment clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AS/AS08_clustering_people.html">AS08 - Clustering Commenters Based on Behavior</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Resource/video_list.html">Python教學影片</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Resource/IDEs.html">Python開發環境</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/p4css/py4css/blob/master/_sources/TM/TM02_collocation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/p4css/py4css" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="來源儲存庫"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/p4css/py4css/issues/new?title=Issue%20on%20page%20%2FTM/TM02_collocation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="開啟議題"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="下載此頁面">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/TM/TM02_collocation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="下載原始檔"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="列印成 PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全螢幕模式"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>TM02 Collocation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目錄 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">TM02 Collocation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduciton-to-collocation">Introduciton to Collocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-preprocessing">Text preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#most-frequent-tokens-term-frequency">Most Frequent Tokens: Term frequency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bigram">Bigram</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-the-most-frequent-consecutive-pair-of-word">Counting the most frequent consecutive pair of word</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-stopwords">Removing stopwords</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distant-collocations">Distant Collocations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#most-frequent-collocations-with-a-distance-of-k">Most frequent collocations with a distance of k</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">詞對的常見距離</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">詞對的平均距離</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-one-time-cases">Filtering one-time cases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">印出平均距離最近的詞對</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">印出平均距離在中間的詞對</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-with-offset-deviation">Filtering with offset deviation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-a-higher-supportive-threshold">With a higher supportive threshold</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-s-chi-square-test">Pearson’s Chi-Square Test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-bigrams">Back to bigrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chi-square-function">Chi-Square function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-compute-the-chi-squares">Now we can compute the chi-squares.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-more-frequent-bigrams">Focus on more frequent bigrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-filtering-out-the-stopwords">Now we can filtering out the stopwords</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutual-information">Mutual Information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-function-for-computing-mutual-information">Define a function for computing mutual information</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-filtering-out-the-collocations-containing-stopwords">Now we can filtering out the collocations containing stopwords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asking-chatgpt">Asking chatGPT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simiplist-way-co-occurrence-count">The simiplist way: Co-occurrence count</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layout">Layout</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-layout-fruchterman-reingold">Spring layout (Fruchterman-Reingold)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#question">Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-nltk">Using NLTK</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-pmi-by-nltk">Calculate PMI by NLTK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-raw-freqs-phi-and-t">Calculating raw_freqs, phi, and t</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tm02-collocation">
<h1>TM02 Collocation<a class="headerlink" href="#tm02-collocation" title="Permalink to this headline">#</a></h1>
<ol class="arabic simple">
<li><p>由於共詞對（Collocation）方法會把所有文章的詞共現（Co-occurrence）累加計算才有意義，所以也不用保持原本Pandas的型態，因此可以把要計算共詞對的文章Column從DataFrame中抽出來計算即可。</p></li>
<li><p>共詞對方法有助於捕捉到一群文本的核心觀念，而在圖書資訊領域，這類的研究通常稱為語義網絡（Semantic Network），這方面有相當多的文獻可以看。如果從字面上來理解，Semantic Network可以說是Collocation和Part-of-speech詞性辨識的兩種方法的組合，意味著要抽取的網路是基於某些特定詞性的關係。</p></li>
<li><p>Collocation有好幾個指標，本教學介紹了Frequency(count)、correlation、mutual information三個指標。</p></li>
<li><p>基於共詞對的出現次數多寡，本章節介紹了高低Correlation、MI共詞對所捕捉到的詞彙特性。</p></li>
<li><p>底下會逐步介紹如何動手設計這些指標，但也可以如本章節最後一個段落所教的，直接套用NTLK的函式。</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/jirlong/opt/anaconda3/lib/python3.9/site-packages/pandas/core/computation/expressions.py:21: UserWarning: Pandas requires version &#39;2.8.4&#39; or newer of &#39;numexpr&#39; (version &#39;2.8.1&#39; currently installed).
  from pandas.core.computation.check import NUMEXPR_INSTALLED
/Users/jirlong/opt/anaconda3/lib/python3.9/site-packages/pandas/core/arrays/masked.py:60: UserWarning: Pandas requires version &#39;1.3.6&#39; or newer of &#39;bottleneck&#39; (version &#39;1.3.4&#39; currently installed).
  from pandas.core import (
</pre></div>
</div>
</div>
</div>
<section id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">#</a></h2>
<section id="loading-data">
<h3>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">#</a></h3>
<p>本單元將依照政大資科黃瀚萱老師的教材建議，採用一個較長文本《共產黨宣言（The Communist Manifesto）》來介紹Collocation（共詞對），並測試能否找到一些該文本的特徵。該文件可由Project Gutenberg免費電子書處下載，你也可以下載其他的英文書籍來做測試，以觀察文本間的差異。</p>
</section>
</section>
<section id="introduciton-to-collocation">
<h2>Introduciton to Collocation<a class="headerlink" href="#introduciton-to-collocation" title="Permalink to this headline">#</a></h2>
<p>Collocation是指在語言中出現頻率較高、且有著相對固定的詞語搭配。這些詞語在一起出現的頻率高於隨機出現的機率，並且通常具有特定的語意或文化內涵。Collocation在語言學和語料庫研究中扮演著重要角色，可以幫助人們更好地理解和使用語言。在進行collocation研究時，我們會根據兩個單詞在特定位置出現的頻率來判斷它們之間是否存在特殊的語法、語義或主題相關關係。比如，如果兩個單詞在同一篇文章中出現的機率比隨機出現的機率更高，那麼我們就可以判斷它們是collocate。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># using colab</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">!wget https://raw.githubusercontent.com/P4CSS/PSS/master/data/corpus02.txt -O corpus02.txt</span>
<span class="sd">with open(&quot;corpus02.txt&quot;, encoding=&quot;utf8&quot;) as fin:</span>
<span class="sd">    text = fin.read()</span>
<span class="sd">print(f&quot;Number of characters: {len(text)}&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n!wget https://raw.githubusercontent.com/P4CSS/PSS/master/data/corpus02.txt -O corpus02.txt\nwith open(&quot;corpus02.txt&quot;, encoding=&quot;utf8&quot;) as fin:\n    text = fin.read()\nprint(f&quot;Number of characters: {len(text)}&quot;)\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># github + jupyterlab</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/corpus02.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of characters: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of characters: 75346
</pre></div>
</div>
</div>
</div>
</section>
<section id="text-preprocessing">
<h2>Text preprocessing<a class="headerlink" href="#text-preprocessing" title="Permalink to this headline">#</a></h2>
<p>在文本處理過程，通常會在前處理階段先刪除停用詞（Stop-words），但之後我們會要計算共詞對（Collocation）的距離。如果在這個階段就把停用詞拿掉的話，共詞對的距離計算會有誤。所以應該是到最後在計算共詞對的數量時才篩除不處理。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="c1"># nltk.download(&#39;punkt&#39;)</span>

<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="c1"># from nltk.corpus import stopwords</span>
<span class="c1"># stopword_list = stopwords.words(&#39;english&#39;)</span>

<span class="n">raw_tokens</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">raw_tokens</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
<span class="c1">#         if token.lower() not in stopword_list: </span>
        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of characters: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of characters: 75346
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tokens</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;manifesto&#39;, &#39;of&#39;, &#39;the&#39;, &#39;communist&#39;, &#39;party&#39;, &#39;by&#39;, &#39;karl&#39;, &#39;marx&#39;, &#39;and&#39;, &#39;frederick&#39;, &#39;engels&#39;, &#39;a&#39;, &#39;specter&#39;, &#39;is&#39;, &#39;haunting&#39;, &#39;europe&#39;, &#39;the&#39;, &#39;specter&#39;, &#39;of&#39;, &#39;communism&#39;]
manifesto/of/the/communist/party/by/karl/marx/and/frederick/engels/a/specter/is/haunting/europe/the/specter/of/communism
</pre></div>
</div>
</div>
</div>
<section id="most-frequent-tokens-term-frequency">
<h3>Most Frequent Tokens: Term frequency<a class="headerlink" href="#most-frequent-tokens-term-frequency" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">word_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="c1"># for w, c in word_counts.most_common(20):</span>
<span class="c1">#     print(f&quot;{w}\t{c}&quot;)    </span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">word_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>token</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>the</td>
      <td>1167</td>
    </tr>
    <tr>
      <th>1</th>
      <td>of</td>
      <td>801</td>
    </tr>
    <tr>
      <th>2</th>
      <td>and</td>
      <td>360</td>
    </tr>
    <tr>
      <th>3</th>
      <td>in</td>
      <td>299</td>
    </tr>
    <tr>
      <th>4</th>
      <td>to</td>
      <td>279</td>
    </tr>
    <tr>
      <th>5</th>
      <td>a</td>
      <td>173</td>
    </tr>
    <tr>
      <th>6</th>
      <td>is</td>
      <td>138</td>
    </tr>
    <tr>
      <th>7</th>
      <td>that</td>
      <td>128</td>
    </tr>
    <tr>
      <th>8</th>
      <td>by</td>
      <td>123</td>
    </tr>
    <tr>
      <th>9</th>
      <td>class</td>
      <td>104</td>
    </tr>
    <tr>
      <th>10</th>
      <td>with</td>
      <td>101</td>
    </tr>
    <tr>
      <th>11</th>
      <td>it</td>
      <td>100</td>
    </tr>
    <tr>
      <th>12</th>
      <td>bourgeois</td>
      <td>99</td>
    </tr>
    <tr>
      <th>13</th>
      <td>all</td>
      <td>98</td>
    </tr>
    <tr>
      <th>14</th>
      <td>bourgeoisie</td>
      <td>92</td>
    </tr>
    <tr>
      <th>15</th>
      <td>as</td>
      <td>86</td>
    </tr>
    <tr>
      <th>16</th>
      <td>for</td>
      <td>84</td>
    </tr>
    <tr>
      <th>17</th>
      <td>they</td>
      <td>83</td>
    </tr>
    <tr>
      <th>18</th>
      <td>its</td>
      <td>81</td>
    </tr>
    <tr>
      <th>19</th>
      <td>their</td>
      <td>80</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="bigram">
<h2>Bigram<a class="headerlink" href="#bigram" title="Permalink to this headline">#</a></h2>
<p>Bigram指的是一個文本或序列中連續（consecutive）的兩個詞語，也可以稱為雙詞語。換句話說，它是兩個相鄰詞語組成的序列，其中一個詞語緊接在另一個詞語後面。</p>
<p>Bigram和Collocation都是語言學中研究詞語搭配的概念。Bigram通常指的是相鄰的兩個詞語組成的序列，Collocation則是指頻繁出現在一起的詞語組合。在文本分析中，Bigram和Collocation都可以用來建立語言模型、預測下一個詞語或詞語組合的機率、進行文本分類等等。兩者最大的相同處是都強調了詞語之間的關聯性和上下文信息的重要性。</p>
<p>可以說Bigram是一種Collocation，但是Collocation不一定是Bigram。Bigram是指相鄰的兩個詞語組成的序列，而Collocation則是指頻繁出現在一起的詞語組合。Bigram是Collocation的一種特例，因為Bigram只考慮相鄰的兩個詞語，而Collocation則可能包括更長的詞語組合，也可以跨越多個詞語。因此，Bigram是Collocation的一種形式化表達，而Collocation則更廣泛地描述了詞語之間的關聯性。</p>
<section id="counting-the-most-frequent-consecutive-pair-of-word">
<h3>Counting the most frequent consecutive pair of word<a class="headerlink" href="#counting-the-most-frequent-consecutive-pair-of-word" title="Permalink to this headline">#</a></h3>
<p>在Python中，Tuple是一種不可變（<em>Immutable</em>）的序列，而List是可變的序列。因此，通常我們可以使用List來儲存和操作序列資料。但在某些情況下，Tuple也可以作為List的一個元素或索引使用。在這個例子中，我們使用<code class="docutils literal notranslate"><span class="pre">(w1,</span> <span class="pre">w2)</span></code>作為<code class="docutils literal notranslate"><span class="pre">word_pair_counts</span></code>的鍵，這樣就可以 確保每對單詞都是唯一的。而如果我們使用List作為鍵，由於List是可變對象（<em>Mutable</em>），不能被用作字典的鍵。因此，使用Tuple作為鍵是一個很好的選擇。最後，<code class="docutils literal notranslate"><span class="pre">word_pair_counts</span></code>將包含所有相鄰單詞對及其頻率的計數器。</p>
<p><strong>Trick</strong>: 計算<code class="docutils literal notranslate"><span class="pre">word_pair_counts()</span></code>可以用下面的方法來做，相當於把<code class="docutils literal notranslate"><span class="pre">tokens</span></code>往後shift一格，<code class="docutils literal notranslate"><span class="pre">zip</span></code>後直接丟進<code class="docutils literal notranslate"><span class="pre">Counter()</span></code>。真的是高招。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># word_pair_counts = Counter(zip(tokens, tokens[1:]))</span>


<span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
    
<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(of, the)	244
(in, the)	91
(the, bourgeoisie)	66
(the, proletariat)	50
(to, the)	43
(by, the)	40
(for, the)	38
(of, production)	38
(with, the)	34
(the, bourgeois)	33
(conditions, of)	29
(means, of)	25
(of, society)	24
(against, the)	23
(on, the)	23
(working, class)	23
(to, be)	22
(of, all)	22
(is, the)	21
(the, communists)	21
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>token</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(of, the)</td>
      <td>244</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(in, the)</td>
      <td>91</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(the, bourgeoisie)</td>
      <td>66</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(the, proletariat)</td>
      <td>50</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(to, the)</td>
      <td>43</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(by, the)</td>
      <td>40</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(for, the)</td>
      <td>38</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(of, production)</td>
      <td>38</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(with, the)</td>
      <td>34</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(the, bourgeois)</td>
      <td>33</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(conditions, of)</td>
      <td>29</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(means, of)</td>
      <td>25</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(of, society)</td>
      <td>24</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(against, the)</td>
      <td>23</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(on, the)</td>
      <td>23</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(working, class)</td>
      <td>23</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(to, be)</td>
      <td>22</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(of, all)</td>
      <td>22</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(is, the)</td>
      <td>21</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(the, communists)</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>這兩個程式碼的目的都是要印出word_pair_counts中出現最多的前20個tuple，而tuple裡的兩個元素是兩個詞彙和它們在原始文本中相鄰出現的次數。兩個程式碼的不同點在於，程式碼一使用了一個pair變數來存放tuple中的兩個詞彙，而程式碼二使用了兩個變數w1和w2來分別存放這兩個詞彙。這兩個程式碼的執行結果會是一模一樣的，只是變數的使用不同。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="removing-stopwords">
<h2>Removing stopwords<a class="headerlink" href="#removing-stopwords" title="Permalink to this headline">#</a></h2>
<p>在計算詞對數量的時候才拿除包含停用詞的共詞對（如果沒打算觀察停用詞的話）。但如果是在構式方法（Construction-based）中，停用詞中的代名詞、that或介系詞可能都會因為研究旨趣而需有所取捨，故建議仔細考量拿去停用詞的時機。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="n">stopword_list</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>

<span class="n">word_pair_nosw_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">w1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span> <span class="ow">and</span> <span class="n">w2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span><span class="p">:</span>
        <span class="n">word_pair_nosw_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># pd.DataFrame(word_pair_nosw_counts.most_common(20), columns=[&quot;token&quot;, &quot;count&quot;])    </span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_nosw_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(working, class)	23
(bourgeois, society)	15
(class, antagonisms)	11
(modern, industry)	11
(ruling, class)	11
(productive, forces)	9
(modern, bourgeois)	8
(middle, ages)	7
(bourgeois, property)	7
(private, property)	7
(feudal, society)	6
(middle, class)	6
(social, conditions)	6
(property, relations)	6
(class, struggle)	6
(old, society)	6
(petty, bourgeois)	6
(existing, society)	5
(one, word)	5
(bourgeois, socialism)	5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package stopwords to
[nltk_data]     /Users/jirlong/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre></div>
</div>
</div>
</div>
</section>
<section id="distant-collocations">
<h2>Distant Collocations<a class="headerlink" href="#distant-collocations" title="Permalink to this headline">#</a></h2>
<p>假設我們要研究 “cat” 這個詞彙在英語語料中與 “fish” 這個詞彙的距離。傳統的 collocation 研究只會考慮這兩個詞彙相鄰出現的情況，但在 distant collocation 研究中，我們會考慮它們在文本中相隔一些距離的情況。</p>
<section id="most-frequent-collocations-with-a-distance-of-k">
<h3>Most frequent collocations with a distance of k<a class="headerlink" href="#most-frequent-collocations-with-a-distance-of-k" title="Permalink to this headline">#</a></h3>
<p>這個例子中，使用了一個<code class="docutils literal notranslate"><span class="pre">window_size</span></code>的概念，代表著從每個詞彙開始往前或往後最多可以看到多遠的詞彙。在這個程式碼中，<code class="docutils literal notranslate"><span class="pre">window_size</span></code>被設定為<code class="docutils literal notranslate"><span class="pre">9</span></code>。</p>
<p>接著，迴圈會進行<code class="docutils literal notranslate"><span class="pre">tokens</span></code>列表的內容遍歷，從第一個詞彙開始一直到倒數第二個詞彙，以每一個詞彙為起點，往後最多看到<code class="docutils literal notranslate"><span class="pre">window_size</span></code>個詞彙的範圍內，所有兩個詞彙之間的距離（也就是中間隔了多少個詞彙）進行統計。例如，如果一個句子中有詞彙”apple”, “banana”, “cherry”, “date”, “elderberry”，那麼當window_size被設定為9時，從”apple”開始，可以看到與它距離最近的詞彙是”banana”，距離為1；從”apple”開始，可以看到與它距離最遠的詞彙是”elderberry”，距離為4。最後，兩個詞彙之間的距離與它們共同出現的次數都被記錄在兩個<code class="docutils literal notranslate"><span class="pre">Counter</span></code>物件<code class="docutils literal notranslate"><span class="pre">word_pair_distance_counts</span></code>和<code class="docutils literal notranslate"><span class="pre">word_pair_counts</span></code>中，以方便進一步的分析。這個過程就是Distant collocation分析的過程。</p>
<p><code class="docutils literal notranslate"><span class="pre">word_pair_counts</span></code>紀錄的是每對詞出現的次數，這是為了作為分母來抵銷掉詞對出現次數多寡的影響。在計算Distant Collocation時，若只考慮詞對之間的距離而不考慮詞對出現的次數，可能會出現詞對出現次數較多但是距離較遠的情況被誤判為collocation的情況，而這樣的情況不符合collocation的定義。因此，除了紀錄詞對之間的距離，我們還需要考慮詞對出現的次數，來抵銷掉詞對多寡的影響。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window_size</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">word_pair_distance_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="n">w1</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">distance</span><span class="p">]</span>
            <span class="n">word_pair_distance_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_pair_counts</span><span class="p">))</span>
            
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>53403
(the, of)	d=2	n=302
(of, the)	d=1	n=244
(the, the)	d=3	n=186
(the, the)	d=8	n=134
(the, the)	d=6	n=129
(the, the)	d=7	n=126
(the, of)	d=3	n=125
(the, the)	d=4	n=117
(the, the)	d=5	n=114
(of, the)	d=4	n=92
(in, the)	d=1	n=91
(of, the)	d=8	n=91
(of, the)	d=6	n=88
(the, of)	d=7	n=81
(the, of)	d=6	n=77
(of, the)	d=7	n=76
(the, of)	d=5	n=76
(the, of)	d=8	n=75
(of, the)	d=5	n=72
(the, bourgeoisie)	d=1	n=66
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>詞對的常見距離<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>這個程式碼使用了一個for迴圈從1到window_size去計算兩個詞在各個距離範圍內的出現次數。程式碼中的print語句將每個距離範圍內的詞對(‘the’, ‘of’)的出現次數輸出到控制台上，並以此來計算這個詞對的平均距離。因為在這裡是以一個固定的詞對來觀察，所以可以通過計算這個詞對在各個距離範圍內的出現次數，來推斷這個詞對常出現的平均距離。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">word_pair_distance_counts</span><span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">word_pair_distance_counts</span><span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>


<span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(the, of), d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">word_pair_distance_counts</span><span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;of&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&#39;the&#39;, &#39;of&#39;, 2), 302)
3
0
(the, of), d=1, n=3
(the, of), d=2, n=302
(the, of), d=3, n=125
(the, of), d=4, n=59
(the, of), d=5, n=76
(the, of), d=6, n=77
(the, of), d=7, n=81
(the, of), d=8, n=75
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>詞對的平均距離<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p>程式碼會從<code class="docutils literal notranslate"><span class="pre">word_pair_distance_counts</span></code>中取出每一個詞對和該詞對的距離，然後計算該詞對的平均距離，並將其存在 <code class="docutils literal notranslate"><span class="pre">pair_mean_distances</span></code>變數中。在計算平均距離時，程式碼會將距離乘以詞對的出現次數（即<code class="docutils literal notranslate"><span class="pre">word_pair_counts</span></code>中的值），然後再除以詞對出現的總次數。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_mean_distances</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="n">pair_mean_distances</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)])</span>

<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">distance</span> <span class="ow">in</span> <span class="n">pair_mean_distances</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(of, destroyed)	d=8.0	n=3
(to, petty)	d=8.0	n=3
(necessarily, of)	d=8.0	n=3
(in, communistic)	d=8.0	n=2
(world, and)	d=8.0	n=2
(and, existing)	d=8.0	n=2
(is, slave)	d=8.0	n=2
(an, each)	d=8.0	n=2
(time, society)	d=8.0	n=2
(an, communication)	d=8.0	n=2
(every, we)	d=8.0	n=2
(that, word)	d=8.0	n=2
(bourgeoisie, market)	d=8.0	n=2
(of, feet)	d=8.0	n=2
(population, property)	d=8.0	n=2
(at, these)	d=8.0	n=2
(our, relations)	d=8.0	n=2
(is, subsistence)	d=8.0	n=2
(disposal, the)	d=8.0	n=2
(wealth, bourgeoisie)	d=8.0	n=2
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtering-one-time-cases">
<h3>Filtering one-time cases<a class="headerlink" href="#filtering-one-time-cases" title="Permalink to this headline">#</a></h3>
<p>不考慮只出現一次過的詞對<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">word_pair_counts[(w1,</span> <span class="pre">w2)]</span> <span class="pre">&gt;</span> <span class="pre">1:</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_mean_distances</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pair_mean_distances</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">distance</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)])</span>

<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">distance</span> <span class="ow">in</span> <span class="n">pair_mean_distances</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(of, destroyed)	d=8.0	n=3
(to, petty)	d=8.0	n=3
(necessarily, of)	d=8.0	n=3
(in, communistic)	d=8.0	n=2
(world, and)	d=8.0	n=2
(and, existing)	d=8.0	n=2
(is, slave)	d=8.0	n=2
(an, each)	d=8.0	n=2
(time, society)	d=8.0	n=2
(an, communication)	d=8.0	n=2
(every, we)	d=8.0	n=2
(that, word)	d=8.0	n=2
(bourgeoisie, market)	d=8.0	n=2
(of, feet)	d=8.0	n=2
(population, property)	d=8.0	n=2
(at, these)	d=8.0	n=2
(our, relations)	d=8.0	n=2
(is, subsistence)	d=8.0	n=2
(disposal, the)	d=8.0	n=2
(wealth, bourgeoisie)	d=8.0	n=2
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h4>印出平均距離最近的詞對<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">distance</span> <span class="ow">in</span> <span class="n">pair_mean_distances</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(continued, existence)	d=1.0	n=2
(complete, systems)	d=1.0	n=2
(they, wish)	d=1.0	n=2
(new, jerusalem)	d=1.0	n=2
(every, revolutionary)	d=1.0	n=2
(revolutionary, movement)	d=1.0	n=2
(could, be)	d=1.0	n=2
(and, others)	d=1.0	n=2
(these, systems)	d=1.0	n=2
(social, science)	d=1.0	n=2
(most, suffering)	d=1.0	n=2
(suffering, class)	d=1.0	n=2
(antagonisms, they)	d=1.0	n=2
(their, ends)	d=1.0	n=2
(a, critical)	d=1.0	n=2
(these, proposals)	d=1.0	n=2
(chiefly, to)	d=1.0	n=2
(they, support)	d=1.0	n=2
(partly, of)	d=1.0	n=2
(existing, social)	d=1.0	n=2
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h4>印出平均距離在中間的詞對<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair_mean_distances</span><span class="p">)</span>
<span class="n">mid</span> <span class="o">=</span> <span class="n">num_pairs</span> <span class="o">//</span> <span class="mi">2</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">distance</span> <span class="ow">in</span> <span class="n">pair_mean_distances</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="n">mid</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="n">mid</span><span class="o">+</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">d=</span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(which, laborer)	d=4.5	n=2
(in, bare)	d=4.5	n=2
(a, existence)	d=4.5	n=2
(means, appropriation)	d=4.5	n=2
(intend, the)	d=4.5	n=2
(personal, appropriation)	d=4.5	n=2
(labor, appropriation)	d=4.5	n=2
(and, leaves)	d=4.5	n=2
(away, is)	d=4.5	n=2
(is, far)	d=4.5	n=2
(the, living)	d=4.5	n=2
(to, accumulated)	d=4.5	n=2
(increase, labor)	d=4.5	n=2
(accumulated, is)	d=4.5	n=2
(enrich, the)	d=4.5	n=2
(past, society)	d=4.5	n=4
(dominates, present)	d=4.5	n=2
(the, person)	d=4.5	n=2
(trade, selling)	d=4.5	n=2
(but, selling)	d=4.5	n=2
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="filtering-with-offset-deviation">
<h3>Filtering with offset deviation<a class="headerlink" href="#filtering-with-offset-deviation" title="Permalink to this headline">#</a></h3>
<p>單純計算詞對的平均距離，可能無法全面了解詞對出現的情況。因此，我們需要觀察詞對出現的變異性。為此，我們計算詞對的變異數，其計算方式為詞對的數量乘上該詞對的距離與平均距離差的平方。這段程式碼是計算詞對的變異數，首先初始化了一個<code class="docutils literal notranslate"><span class="pre">Counter</span></code>為<code class="docutils literal notranslate"><span class="pre">pair_deviations</span></code>，接下來使用for loop遍歷<code class="docutils literal notranslate"><span class="pre">word_pair_distance_counts</span></code>，判斷詞對出現次數是否大於1，如果是，則計算該詞對的變異數，並將結果存入<code class="docutils literal notranslate"><span class="pre">pair_deviations</span></code>中。最後，再次遍歷<code class="docutils literal notranslate"><span class="pre">pair_deviations</span></code>，計算每個詞對的標準差，並將其存入<code class="docutils literal notranslate"><span class="pre">pair_deviations</span></code>中，這樣便完成了詞對變異數的計算。</p>
<p>需要注意的是，當詞對出現的次數小於等於1時，其變異數為零。所以篩去了詞對僅出現過一次的詞對<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">word_pair_counts[(w1,</span> <span class="pre">w2)]</span> <span class="pre">&gt;</span> <span class="pre">1:</span></code>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_deviations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pair_deviations</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">distance</span> <span class="o">-</span> <span class="n">pair_mean_distances</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">dev_tmp</span> <span class="ow">in</span> <span class="n">pair_deviations</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="n">s_2</span> <span class="o">=</span> <span class="n">dev_tmp</span> <span class="o">/</span> <span class="p">(</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pair_deviations</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s_2</span> <span class="o">**</span> <span class="mf">0.5</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">pair_mean_distances</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">dev</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">pair_deviations</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>
    
<span class="c1"># for (w1, w2), dev in pair_deviations.most_common(20):</span>
<span class="c1">#     print(f&quot;({w1}, {w2})\t d(m,sd)=({pair_mean_distances[(w1, w2)]}, {dev:.2f})\tn={word_pair_counts[(w1, w2)]}&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>mean</th>
      <th>sd</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(the, branding)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(sketched, the)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(class, struggles)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(journeyman, in)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(in, almost)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(epochs, of)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(everywhere, a)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(old, bourgeois)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(navigation, and)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(vanished, in)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(the, giant)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(the, leaders)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(armies, the)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(its, capital)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(oppressed, class)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(the, executive)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(enthusiasm, of)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(of, egotistical)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(its, relation)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(ones, that)</td>
      <td>4.5</td>
      <td>4.95</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">pair_mean_distances</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">dev</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">pair_deviations</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>

<span class="c1"># for (w1, w2), dev in pair_deviations.most_common()[-20:]:</span>
<span class="c1">#     print(f&quot;({w1}, {w2})\t d(m,sd)=({pair_mean_distances[(w1, w2)]}, {dev:.2f})\tn={word_pair_counts[(w1, w2)]}&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>mean</th>
      <th>sd</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(being, class)</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(most, suffering)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(suffering, class)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(antagonisms, they)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(the, appeal)</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(they, ends)</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(their, ends)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(a, critical)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(these, proposals)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(of, c)</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(chiefly, to)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(chiefly, germany)</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(communists, against)</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(they, support)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(partly, of)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(partly, in)</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(germany, fight)</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(revolutionary, against)</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(germany, immediately)</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(existing, social)</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="with-a-higher-supportive-threshold">
<h3>With a higher supportive threshold<a class="headerlink" href="#with-a-higher-supportive-threshold" title="Permalink to this headline">#</a></h3>
<p>前述案例觀察了出現超過一次的詞對的詞對距離變異，
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">word_pair_counts[(w1,</span> <span class="pre">w2)]</span> <span class="pre">&gt;</span> <span class="pre">1:</span></code>
接下來則希望觀察出現超過10次的詞對，這主要是為了觀察，文本中比較常出現的詞對。且值得注意的是，這是<code class="docutils literal notranslate"><span class="pre">windows=9</span></code>的詞對。未來也可以照需求把它改成，在同一個句子中的詞對。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_deviations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">distance</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_distance_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">pair_deviations</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">distance</span> <span class="o">-</span> <span class="n">pair_mean_distances</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">dev_tmp</span> <span class="ow">in</span> <span class="n">pair_deviations</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="n">s_2</span> <span class="o">=</span> <span class="n">dev_tmp</span> <span class="o">/</span> <span class="p">(</span><span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pair_deviations</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">s_2</span> <span class="o">**</span> <span class="mf">0.5</span>
    
<span class="c1"># for (w1, w2), dev in pair_deviations.most_common()[-20:]:</span>
<span class="c1">#     print(f&quot;({w1}, {w2})\t d(m,sd)=({pair_mean_distances[(w1, w2)]:.2f}, {dev:.2f})\tn={word_pair_counts[(w1, w2)]}&quot;)</span>
    
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">pair_mean_distances</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">dev</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">pair_deviations</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>
    <span class="c1"># print(f&quot;({w1}, {w2})\t d(m,sd)=({pair_mean_distances[(w1, w2)]:.2f}, {dev:.2f})\tn={word_pair_counts[(w1, w2)]}&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>mean</th>
      <th>sd</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(be, and)</td>
      <td>3.83</td>
      <td>1.47</td>
      <td>12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(have, of)</td>
      <td>5.87</td>
      <td>1.46</td>
      <td>23</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(to, be)</td>
      <td>1.42</td>
      <td>1.44</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(the, communism)</td>
      <td>4.45</td>
      <td>1.44</td>
      <td>11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(of, can)</td>
      <td>5.00</td>
      <td>1.41</td>
      <td>11</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(in, but)</td>
      <td>5.00</td>
      <td>1.41</td>
      <td>11</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(for, a)</td>
      <td>2.08</td>
      <td>1.38</td>
      <td>13</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(for, class)</td>
      <td>5.36</td>
      <td>1.36</td>
      <td>11</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(as, and)</td>
      <td>5.15</td>
      <td>1.34</td>
      <td>13</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(has, of)</td>
      <td>5.73</td>
      <td>1.34</td>
      <td>26</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(it, has)</td>
      <td>1.41</td>
      <td>1.33</td>
      <td>22</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(working, class)</td>
      <td>1.36</td>
      <td>1.32</td>
      <td>25</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(in, class)</td>
      <td>5.27</td>
      <td>1.27</td>
      <td>11</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(bourgeois, society)</td>
      <td>1.31</td>
      <td>1.25</td>
      <td>16</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(it, of)</td>
      <td>6.09</td>
      <td>1.24</td>
      <td>34</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(by, means)</td>
      <td>1.69</td>
      <td>0.95</td>
      <td>13</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(in, proportion)</td>
      <td>1.50</td>
      <td>0.90</td>
      <td>12</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(they, are)</td>
      <td>1.25</td>
      <td>0.87</td>
      <td>12</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(modern, industry)</td>
      <td>1.17</td>
      <td>0.58</td>
      <td>12</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(ruling, class)</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="pearson-s-chi-square-test">
<h2>Pearson’s Chi-Square Test<a class="headerlink" href="#pearson-s-chi-square-test" title="Permalink to this headline">#</a></h2>
<section id="back-to-bigrams">
<h3>Back to bigrams<a class="headerlink" href="#back-to-bigrams" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="n">num_bigrams</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">num_bigrams</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">num_bigrams</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11780
</pre></div>
</div>
</div>
</div>
</section>
<section id="chi-square-function">
<h3>Chi-Square function<a class="headerlink" href="#chi-square-function" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">chisquare</span><span class="p">(</span><span class="n">o11</span><span class="p">,</span> <span class="n">o12</span><span class="p">,</span> <span class="n">o21</span><span class="p">,</span> <span class="n">o22</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">o11</span> <span class="o">+</span> <span class="n">o12</span> <span class="o">+</span> <span class="n">o21</span> <span class="o">+</span> <span class="n">o22</span>
    <span class="n">x_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">((</span><span class="n">o11</span> <span class="o">*</span> <span class="n">o22</span> <span class="o">-</span> <span class="n">o12</span> <span class="o">*</span> <span class="n">o21</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">o11</span> <span class="o">+</span> <span class="n">o12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">o11</span> <span class="o">+</span> <span class="n">o21</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">o12</span> <span class="o">+</span> <span class="n">o22</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">o21</span> <span class="o">+</span> <span class="n">o22</span><span class="p">))</span> 
    <span class="k">return</span> <span class="n">x_2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="now-we-can-compute-the-chi-squares">
<h3>Now we can compute the chi-squares.<a class="headerlink" href="#now-we-can-compute-the-chi-squares" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_chi_squares</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="n">w1_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
    <span class="n">w2_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
    <span class="n">rest_count</span> <span class="o">=</span> <span class="n">num_bigrams</span> <span class="o">-</span> <span class="n">w1_only_count</span> <span class="o">-</span> <span class="n">w2_only_count</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
    <span class="n">pair_chi_squares</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">chisquare</span><span class="p">(</span><span class="n">w1_w2_count</span><span class="p">,</span> <span class="n">w1_only_count</span><span class="p">,</span> <span class="n">w2_only_count</span><span class="p">,</span> <span class="n">rest_count</span><span class="p">)</span>

<span class="c1"># for (w1, w2), x_2 in pair_chi_squares.most_common(20):</span>
    <span class="c1"># print(f&quot;{w1}\t{w2}\t{word_pair_counts[(w1, w2)]}\t{x_2}&quot;)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">x_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="n">pair_chi_squares</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;x_2&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(third, estate)</td>
      <td>2</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(constitution, adapted)</td>
      <td>2</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(karl, marx)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(frederick, engels)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(czar, metternich)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(police, spies)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(nursery, tale)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(italian, flemish)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(danish, languages)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(plebeian, lord)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(complicated, arrangement)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(manifold, gradation)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(patricians, knights)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(knights, plebeians)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(journeymen, apprentices)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(subordinate, gradations)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(cape, opened)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(proper, serving)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(left, remaining)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(heavenly, ecstacies)</td>
      <td>1</td>
      <td>11780.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="focus-on-more-frequent-bigrams">
<h3>Focus on more frequent bigrams<a class="headerlink" href="#focus-on-more-frequent-bigrams" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_chi_squares</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">w1_w2_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">w1_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">w2_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">rest_count</span> <span class="o">=</span> <span class="n">num_bigrams</span> <span class="o">-</span> <span class="n">w1_only_count</span> <span class="o">-</span> <span class="n">w2_only_count</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">pair_chi_squares</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">chisquare</span><span class="p">(</span><span class="n">w1_w2_count</span><span class="p">,</span> <span class="n">w1_only_count</span><span class="p">,</span> <span class="n">w2_only_count</span><span class="p">,</span> <span class="n">rest_count</span><span class="p">)</span>

<span class="c1"># for (w1, w2), x_2 in pair_chi_squares.most_common(20):</span>
<span class="c1">#     print(&quot;%s\t%s\t%d\t%f&quot; % (w1, w2, word_pair_counts[(w1, w2)], x_2))</span>
    
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">x_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="n">pair_chi_squares</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;x_2&quot;</span><span class="p">]))</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(productive, forces)</td>
      <td>9</td>
      <td>9636.54</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(middle, ages)</td>
      <td>7</td>
      <td>4928.71</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(no, longer)</td>
      <td>14</td>
      <td>4150.50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(working, class)</td>
      <td>23</td>
      <td>2477.73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(modern, industry)</td>
      <td>11</td>
      <td>1128.04</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(class, antagonisms)</td>
      <td>11</td>
      <td>1042.74</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(private, property)</td>
      <td>7</td>
      <td>1022.52</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(ruling, class)</td>
      <td>11</td>
      <td>966.77</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(can, not)</td>
      <td>9</td>
      <td>775.75</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(their, own)</td>
      <td>11</td>
      <td>759.45</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(proportion, as)</td>
      <td>8</td>
      <td>720.62</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(have, been)</td>
      <td>7</td>
      <td>702.44</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(it, has)</td>
      <td>20</td>
      <td>652.82</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(away, with)</td>
      <td>8</td>
      <td>563.76</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(to, be)</td>
      <td>22</td>
      <td>468.08</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(just, as)</td>
      <td>6</td>
      <td>439.99</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(of, the)</td>
      <td>244</td>
      <td>406.86</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(the, bourgeoisie)</td>
      <td>66</td>
      <td>397.20</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(its, own)</td>
      <td>8</td>
      <td>392.30</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(petty, bourgeois)</td>
      <td>6</td>
      <td>381.07</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">x_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="n">pair_chi_squares</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;x_2&quot;</span><span class="p">]))</span>

<span class="c1"># for (w1, w2), x_2 in pair_chi_squares.most_common()[-20:]:</span>
<span class="c1">#     print(f&quot;{w1}\t{w2}\t{word_pair_counts[(w1, w2)]}\t{x_2}&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(is, the)</td>
      <td>21</td>
      <td>4.41e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(and, by)</td>
      <td>7</td>
      <td>2.91e+00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(at, the)</td>
      <td>7</td>
      <td>2.59e+00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(and, that)</td>
      <td>7</td>
      <td>2.54e+00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(be, the)</td>
      <td>7</td>
      <td>2.37e+00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(proletariat, the)</td>
      <td>10</td>
      <td>2.36e+00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(bourgeois, the)</td>
      <td>6</td>
      <td>1.65e+00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(that, of)</td>
      <td>6</td>
      <td>9.11e-01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(and, of)</td>
      <td>20</td>
      <td>9.07e-01</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(of, class)</td>
      <td>9</td>
      <td>5.69e-01</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(bourgeoisie, the)</td>
      <td>7</td>
      <td>5.49e-01</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(that, the)</td>
      <td>15</td>
      <td>4.76e-01</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(of, its)</td>
      <td>7</td>
      <td>4.37e-01</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(and, in)</td>
      <td>11</td>
      <td>4.02e-01</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(society, the)</td>
      <td>6</td>
      <td>3.07e-01</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(all, the)</td>
      <td>11</td>
      <td>1.92e-01</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(the, property)</td>
      <td>6</td>
      <td>4.11e-02</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(and, to)</td>
      <td>9</td>
      <td>2.78e-02</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(the, class)</td>
      <td>10</td>
      <td>9.97e-03</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(class, the)</td>
      <td>10</td>
      <td>9.97e-03</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="now-we-can-filtering-out-the-stopwords">
<h3>Now we can filtering out the stopwords<a class="headerlink" href="#now-we-can-filtering-out-the-stopwords" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pair_chi_squares</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">w1_w2_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">w1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span> <span class="ow">and</span> <span class="n">w2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span><span class="p">:</span>
        <span class="n">w1_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">w2_only_count</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">rest_count</span> <span class="o">=</span> <span class="n">num_bigrams</span> <span class="o">-</span> <span class="n">w1_only_count</span> <span class="o">-</span> <span class="n">w2_only_count</span> <span class="o">-</span> <span class="n">w1_w2_count</span>
        <span class="n">pair_chi_squares</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">chisquare</span><span class="p">(</span><span class="n">w1_w2_count</span><span class="p">,</span> <span class="n">w1_only_count</span><span class="p">,</span> <span class="n">w2_only_count</span><span class="p">,</span> <span class="n">rest_count</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">x_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="n">pair_chi_squares</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;x_2&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(third, estate)</td>
      <td>2</td>
      <td>11780.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(constitution, adapted)</td>
      <td>2</td>
      <td>11780.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(productive, forces)</td>
      <td>9</td>
      <td>9636.54</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(eternal, truths)</td>
      <td>3</td>
      <td>8834.25</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(corporate, guilds)</td>
      <td>2</td>
      <td>7852.67</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(absolute, monarchy)</td>
      <td>4</td>
      <td>7537.60</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(eighteenth, century)</td>
      <td>3</td>
      <td>7066.80</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(immense, majority)</td>
      <td>3</td>
      <td>6624.75</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(laid, bare)</td>
      <td>2</td>
      <td>5889.00</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(distinctive, feature)</td>
      <td>2</td>
      <td>5234.22</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(torn, asunder)</td>
      <td>2</td>
      <td>5234.22</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(middle, ages)</td>
      <td>7</td>
      <td>4928.71</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(radical, rupture)</td>
      <td>2</td>
      <td>4710.80</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(buying, disappears)</td>
      <td>2</td>
      <td>3925.33</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(let, us)</td>
      <td>3</td>
      <td>3310.50</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(upper, hand)</td>
      <td>2</td>
      <td>2943.50</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(commercial, crises)</td>
      <td>2</td>
      <td>2943.50</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(various, stages)</td>
      <td>2</td>
      <td>2943.50</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(united, action)</td>
      <td>3</td>
      <td>2942.75</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(raw, material)</td>
      <td>2</td>
      <td>2616.22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">x_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="n">pair_chi_squares</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;x_2&quot;</span><span class="p">]))</span>

<span class="c1"># for (w1, w2), x_2 in pair_chi_squares.most_common()[-20:]:</span>
<span class="c1">#     print(f&quot;{w1}\t{w2}\t{word_pair_counts[(w1, w2)]}\t{x_2}&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(many, bourgeois)</td>
      <td>2</td>
      <td>49.41</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(bourgeois, private)</td>
      <td>2</td>
      <td>44.09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(petty, bourgeoisie)</td>
      <td>2</td>
      <td>43.02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(modern, working)</td>
      <td>2</td>
      <td>41.99</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(bourgeois, freedom)</td>
      <td>2</td>
      <td>39.73</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(revolutionary, proletariat)</td>
      <td>2</td>
      <td>35.10</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(old, conditions)</td>
      <td>2</td>
      <td>32.57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(feudal, property)</td>
      <td>2</td>
      <td>31.39</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(old, property)</td>
      <td>2</td>
      <td>28.69</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(bourgeois, revolution)</td>
      <td>2</td>
      <td>26.14</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(modern, bourgeoisie)</td>
      <td>3</td>
      <td>21.38</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(whole, bourgeoisie)</td>
      <td>2</td>
      <td>20.75</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(revolutionary, class)</td>
      <td>2</td>
      <td>20.22</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(bourgeois, state)</td>
      <td>2</td>
      <td>17.06</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(every, class)</td>
      <td>2</td>
      <td>16.08</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(bourgeois, conditions)</td>
      <td>3</td>
      <td>16.04</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(bourgeois, form)</td>
      <td>2</td>
      <td>14.68</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(one, class)</td>
      <td>2</td>
      <td>10.56</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(bourgeois, production)</td>
      <td>2</td>
      <td>5.66</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(bourgeois, class)</td>
      <td>3</td>
      <td>5.26</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="mutual-information">
<h2>Mutual Information<a class="headerlink" href="#mutual-information" title="Permalink to this headline">#</a></h2>
<section id="define-a-function-for-computing-mutual-information">
<h3>Define a function for computing mutual information<a class="headerlink" href="#define-a-function-for-computing-mutual-information" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">mutual_information</span><span class="p">(</span><span class="n">w1_w2_prob</span><span class="p">,</span> <span class="n">w1_prob</span><span class="p">,</span> <span class="n">w2_prob</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">w1_w2_prob</span> <span class="o">/</span> <span class="p">(</span><span class="n">w1_prob</span> <span class="o">*</span> <span class="n">w2_prob</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_unigrams</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">pair_mutual_information_scores</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">w1_w2_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">w1_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w2_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w1_w2_prob</span> <span class="o">=</span> <span class="n">w1_w2_count</span> <span class="o">/</span> <span class="n">num_bigrams</span>
        <span class="n">pair_mutual_information_scores</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mutual_information</span><span class="p">(</span><span class="n">w1_w2_prob</span><span class="p">,</span> <span class="n">w1_prob</span><span class="p">,</span> <span class="n">w2_prob</span><span class="p">)</span>


<span class="c1"># for (w1, w2), mi in pair_mutual_information_scores.most_common(20):</span>
<span class="c1">#     print(f&quot;{w1}\t{w2}\t{word_pair_counts[(w1, w2)]}\t{mi}&quot;)</span>
    
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">mi</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">pair_mutual_information_scores</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;mi&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(karl, marx)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(frederick, engels)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(czar, metternich)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(police, spies)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(nursery, tale)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(italian, flemish)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(danish, languages)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(plebeian, lord)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(complicated, arrangement)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(manifold, gradation)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(patricians, knights)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(knights, plebeians)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(journeymen, apprentices)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(subordinate, gradations)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(cape, opened)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(proper, serving)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(left, remaining)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(heavenly, ecstacies)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(chivalrous, enthusiasm)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(egotistical, calculation)</td>
      <td>1</td>
      <td>13.52</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_unigrams</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">pair_mutual_information_scores</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">w1_w2_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">w1_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w2_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w1_w2_prob</span> <span class="o">=</span> <span class="n">w1_w2_count</span> <span class="o">/</span> <span class="n">num_bigrams</span>
        <span class="n">pair_mutual_information_scores</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mutual_information</span><span class="p">(</span><span class="n">w1_w2_prob</span><span class="p">,</span> <span class="n">w1_prob</span><span class="p">,</span> <span class="n">w2_prob</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">mi</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">pair_mutual_information_scores</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;mi&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(productive, forces)</td>
      <td>9</td>
      <td>10.06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(middle, ages)</td>
      <td>7</td>
      <td>9.46</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(no, longer)</td>
      <td>14</td>
      <td>8.22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(private, property)</td>
      <td>7</td>
      <td>7.20</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(working, class)</td>
      <td>23</td>
      <td>6.76</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(modern, industry)</td>
      <td>11</td>
      <td>6.70</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(have, been)</td>
      <td>7</td>
      <td>6.67</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(class, antagonisms)</td>
      <td>11</td>
      <td>6.58</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(proportion, as)</td>
      <td>8</td>
      <td>6.51</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(ruling, class)</td>
      <td>11</td>
      <td>6.48</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(can, not)</td>
      <td>9</td>
      <td>6.45</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(just, as)</td>
      <td>6</td>
      <td>6.22</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(away, with)</td>
      <td>8</td>
      <td>6.17</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(their, own)</td>
      <td>11</td>
      <td>6.14</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(petty, bourgeois)</td>
      <td>6</td>
      <td>6.02</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(middle, class)</td>
      <td>6</td>
      <td>5.71</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(its, own)</td>
      <td>8</td>
      <td>5.66</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(property, relations)</td>
      <td>6</td>
      <td>5.66</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(not, only)</td>
      <td>7</td>
      <td>5.55</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(class, struggle)</td>
      <td>6</td>
      <td>5.32</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="now-we-can-filtering-out-the-collocations-containing-stopwords">
<h3>Now we can filtering out the collocations containing stopwords<a class="headerlink" href="#now-we-can-filtering-out-the-collocations-containing-stopwords" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_unigrams</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">pair_mutual_information_scores</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">w1_w2_count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">w1_w2_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">w1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span> <span class="ow">and</span> <span class="n">w2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span><span class="p">:</span>
        <span class="n">w1_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w2_prob</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_unigrams</span>
        <span class="n">w1_w2_prob</span> <span class="o">=</span> <span class="n">w1_w2_count</span> <span class="o">/</span> <span class="n">num_bigrams</span>
        <span class="n">pair_mutual_information_scores</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mutual_information</span><span class="p">(</span><span class="n">w1_w2_prob</span><span class="p">,</span> <span class="n">w1_prob</span><span class="p">,</span> <span class="n">w2_prob</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">pair</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">mi</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">pair_mutual_information_scores</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
             <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;mi&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pair</th>
      <th>count</th>
      <th>mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(third, estate)</td>
      <td>2</td>
      <td>12.52</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(constitution, adapted)</td>
      <td>2</td>
      <td>12.52</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(corporate, guilds)</td>
      <td>2</td>
      <td>11.94</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(eternal, truths)</td>
      <td>3</td>
      <td>11.52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(laid, bare)</td>
      <td>2</td>
      <td>11.52</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(distinctive, feature)</td>
      <td>2</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>6</th>
      <td>(torn, asunder)</td>
      <td>2</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>7</th>
      <td>(eighteenth, century)</td>
      <td>3</td>
      <td>11.20</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(radical, rupture)</td>
      <td>2</td>
      <td>11.20</td>
    </tr>
    <tr>
      <th>9</th>
      <td>(immense, majority)</td>
      <td>3</td>
      <td>11.11</td>
    </tr>
    <tr>
      <th>10</th>
      <td>(buying, disappears)</td>
      <td>2</td>
      <td>10.94</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(absolute, monarchy)</td>
      <td>4</td>
      <td>10.88</td>
    </tr>
    <tr>
      <th>12</th>
      <td>(upper, hand)</td>
      <td>2</td>
      <td>10.52</td>
    </tr>
    <tr>
      <th>13</th>
      <td>(commercial, crises)</td>
      <td>2</td>
      <td>10.52</td>
    </tr>
    <tr>
      <th>14</th>
      <td>(various, stages)</td>
      <td>2</td>
      <td>10.52</td>
    </tr>
    <tr>
      <th>15</th>
      <td>(earlier, epochs)</td>
      <td>2</td>
      <td>10.35</td>
    </tr>
    <tr>
      <th>16</th>
      <td>(raw, material)</td>
      <td>2</td>
      <td>10.35</td>
    </tr>
    <tr>
      <th>17</th>
      <td>(complete, systems)</td>
      <td>2</td>
      <td>10.35</td>
    </tr>
    <tr>
      <th>18</th>
      <td>(guild, masters)</td>
      <td>2</td>
      <td>10.20</td>
    </tr>
    <tr>
      <th>19</th>
      <td>(best, possible)</td>
      <td>2</td>
      <td>10.20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="asking-chatgpt">
<h3>Asking chatGPT<a class="headerlink" href="#asking-chatgpt" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Set the minimum threshold for PMI and collocation count</span>
<span class="n">min_pmi</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">min_count</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Calculate the PMI and collocation count for each word pair</span>
<span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="n">total_words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
<span class="n">word_pair_pmi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pmi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">((</span><span class="n">count</span> <span class="o">*</span> <span class="n">total_words</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">word_counts</span><span class="p">[</span><span class="n">w1</span><span class="p">]</span> <span class="o">*</span> <span class="n">word_counts</span><span class="p">[</span><span class="n">w2</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">pmi</span> <span class="o">&gt;=</span> <span class="n">min_pmi</span><span class="p">:</span>
        <span class="n">word_pair_pmi</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pmi</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="c1"># Filter the word pairs based on the minimum threshold for collocation count</span>
<span class="n">high_pmi_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">pair</span><span class="p">,</span> <span class="n">pmi</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="p">(</span><span class="n">pmi</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="n">word_pair_pmi</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="p">]</span>

<span class="c1"># Sort the word pairs by decreasing PMI and collocation count</span>
<span class="n">high_pmi_pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">high_pmi_pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Print the top 10 word pairs</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">pmi</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">high_pmi_pairs</span><span class="p">[:</span><span class="mi">20</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">. </span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="s2">PMI=</span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">count=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pmi</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. third	estate	PMI=12.52	count=2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2. constitution	adapted	PMI=12.52	count=2
3. corporate	guilds	PMI=11.94	count=2
4. eternal	truths	PMI=11.52	count=3
5. handed	down	PMI=11.52	count=2
6. laid	bare	PMI=11.52	count=2
7. distinctive	feature	PMI=11.35	count=2
8. torn	asunder	PMI=11.35	count=2
9. eighteenth	century	PMI=11.20	count=3
10. radical	rupture	PMI=11.20	count=2
11. immense	majority	PMI=11.11	count=3
12. buying	disappears	PMI=10.94	count=2
13. absolute	monarchy	PMI=10.88	count=4
14. upper	hand	PMI=10.52	count=2
15. commercial	crises	PMI=10.52	count=2
16. various	stages	PMI=10.52	count=2
17. earlier	epochs	PMI=10.35	count=2
18. raw	material	PMI=10.35	count=2
19. complete	systems	PMI=10.35	count=2
20. guild	masters	PMI=10.20	count=2
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-simiplist-way-co-occurrence-count">
<h1>The simiplist way: Co-occurrence count<a class="headerlink" href="#the-simiplist-way-co-occurrence-count" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window_size</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">word_pair_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">distance</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">distance</span><span class="p">]:</span>
                    <span class="n">w1</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">w2</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">distance</span><span class="p">]</span>
                    <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word_pair_counts</span><span class="p">))</span>
            
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="s2">n=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10231
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(working, class)	n=24
(bourgeois, society)	n=15
(class, antagonisms)	n=12
(modern, industry)	n=12
(conditions, existence)	n=12
(bourgeois, property)	n=11
(ruling, class)	n=11
(means, production)	n=9
(productive, forces)	n=9
(modern, bourgeois)	n=8
(conditions, production)	n=8
(old, society)	n=8
(middle, ages)	n=7
(production, exchange)	n=7
(instruments, production)	n=7
(social, conditions)	n=7
(bourgeois, production)	n=7
(property, relations)	n=7
(abolition, property)	n=7
(private, property)	n=7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;w1&quot;</span><span class="p">,</span> <span class="s2">&quot;w2&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>w1</th>
      <th>w2</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>working</td>
      <td>class</td>
      <td>24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bourgeois</td>
      <td>society</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2</th>
      <td>class</td>
      <td>antagonisms</td>
      <td>12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>modern</td>
      <td>industry</td>
      <td>12</td>
    </tr>
    <tr>
      <th>4</th>
      <td>conditions</td>
      <td>existence</td>
      <td>12</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>155</th>
      <td>government</td>
      <td>bourgeois</td>
      <td>3</td>
    </tr>
    <tr>
      <th>156</th>
      <td>existing</td>
      <td>state</td>
      <td>3</td>
    </tr>
    <tr>
      <th>157</th>
      <td>material</td>
      <td>conditions</td>
      <td>3</td>
    </tr>
    <tr>
      <th>158</th>
      <td>undeveloped</td>
      <td>state</td>
      <td>3</td>
    </tr>
    <tr>
      <th>159</th>
      <td>new</td>
      <td>social</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>160 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;w1&#39;</span><span class="p">,</span>
                            <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;w2&#39;</span><span class="p">,</span>
                            <span class="n">edge_attr</span> <span class="o">=</span> <span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://towardsdatascience.com/visualizing-networks-in-python-d70f4cbeb259">Visualizing Networks in Python</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># df = pd.DataFrame(pair_mutual_information_scores) # ERROR</span>
<span class="n">li</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">word_pair_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)],</span> <span class="n">mi</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">pair_mutual_information_scores</span><span class="o">.</span><span class="n">most_common</span><span class="p">()]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">li</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;w1&#39;</span><span class="p">,</span> <span class="s1">&#39;w2&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mi&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>w1</th>
      <th>w2</th>
      <th>count</th>
      <th>mi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>third</td>
      <td>estate</td>
      <td>2</td>
      <td>12.52</td>
    </tr>
    <tr>
      <th>1</th>
      <td>constitution</td>
      <td>adapted</td>
      <td>2</td>
      <td>12.52</td>
    </tr>
    <tr>
      <th>2</th>
      <td>corporate</td>
      <td>guilds</td>
      <td>2</td>
      <td>11.94</td>
    </tr>
    <tr>
      <th>3</th>
      <td>eternal</td>
      <td>truths</td>
      <td>3</td>
      <td>11.52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>laid</td>
      <td>bare</td>
      <td>2</td>
      <td>11.52</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;w1&#39;</span><span class="p">,</span>
                            <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;w2&#39;</span><span class="p">,</span>
                            <span class="n">edge_attr</span> <span class="o">=</span> <span class="s1">&#39;mi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nx.draw_kamada_kawai(G)</span>
<span class="c1"># nx.draw_spring(G.to_directed())</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># pos = nx.kamada_kawai_layout(G) # need to install graphviz</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;dimgray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/45d3d8e0d9864742e3f480e2b4b9698e1c69e71e6ca61b22767656584bdf19de.png" src="../_images/45d3d8e0d9864742e3f480e2b4b9698e1c69e71e6ca61b22767656584bdf19de.png" />
</div>
</div>
<section id="layout">
<h3>Layout<a class="headerlink" href="#layout" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">graphviz_layout</span></code>:</p>
<ol class="arabic simple">
<li><p>need to install graphviz <a class="reference external" href="https://www.graphviz.org/download/">https://www.graphviz.org/download/</a> by <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">graphviz</span></code>, then</p></li>
<li><p>install pygraphviz by <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pygraphviz</span></code>, then</p></li>
<li><p>import <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">networkx.drawing.nx_agraph</span> <span class="pre">import</span> <span class="pre">graphviz_layout</span></code></p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">kamada_kawai_layout</span></code>和<code class="docutils literal notranslate"><span class="pre">spring_layout</span></code>都是用來定位圖形中節點的位置的算法，但它們基於不同的原理和策略，有一些區別。</p>
<ul class="simple">
<li><p>kamada_kawai_layout使用了基於距離矩陣的嵌入算法，它最小化了節點之間的所有距離和它們的真實距離之間的誤差。這意味著節點間的距離在嵌入期間保持不變。因此，它在處理中等大小和較小的圖形時表現良好，並且對於需要考慮節點之間的精確距離的應用程序非常有用，例如社交網路分析。</p></li>
<li><p>相比之下，spring_layout使用了Fruchterman-Reingold力導向算法，它模擬了一個力學系統，將邊緣視為彈簧，將節點視為互相排斥的物體，有時稱為反重力力量，使節點保持靠近。因此，它對於大型圖形和需要可視化分組的應用程序非常有用。在模擬期間，節點之間的距離可以改變，因此它對於需要可視化節點之間相對距離的應用程序非常有用，例如生物學家將蛋白質相互作用關係繪製為圖形。</p></li>
</ul>
<section id="spring-layout-fruchterman-reingold">
<h4>Spring layout (Fruchterman-Reingold)<a class="headerlink" href="#spring-layout-fruchterman-reingold" title="Permalink to this headline">#</a></h4>
<p>使用 Fruchterman-Reingold 力導向算法來定位節點的位置。該算法模擬了一個力學系統，將邊緣視為連接節點的彈簧，將節點視為互相排斥的物體，有時稱為反重力力量，使節點保持靠近。直到位置趨於平衡為止。函數中有一些參數：節點之間的最小距離（0.01）和「溫度」（0.1），以確保節點不會飛出。在模擬期間，k可以調整節點間的距離。而<code class="docutils literal notranslate"><span class="pre">scale</span></code>和<code class="docutils literal notranslate"><span class="pre">center</span></code>确定重新縮放的大小和位置，以固定某些節點不允許它們在模擬中移動。這也關閉了模擬結束時的重新縮放功能。此外，將 scale 設置為<code class="docutils literal notranslate"><span class="pre">None</span></code>會關閉重新縮放。以下為該函式的參數：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">G</span></code>：NetworkX 圖或節點列表。每個節點都會被分配一個位置。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k</span></code>：float（默認值為 None）。節點之間的最佳距離。如果為 None，則距離設置為 1/sqrt(n)，其中 n 是節點的數量。增加此值可將節點移開。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pos</span></code>：dict 或 None（可選，默認值為 None）。節點的初始位置，作為帶有節點鍵和值的坐標列表或元組的字典。如果為 None，則使用隨機初始位置。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed</span></code>：list 或 None（可選，默認值為 None）。要在初始位置上保持固定的節點。不在 G.nodes 中的節點將被忽略。如果指定了 fixed，而 pos 沒有指定，則引發 ValueError。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iterations</span></code>：int（可選，默認值為 50）。要進行的最大迭代次數。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code>：float（可選，默認值為 1e-4）。節點位置更改的相對誤差閾值。如果誤差低於此閾值，則迭代停止。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight</span></code>：string 或 None（可選，默認值為 ‘weight’）。保存用於邊緣權重的數值的邊緣屬性。越大表示吸引力越強。如果為 None，則所有邊緣權重</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># need to install graphviz</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;dimgray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7f573570a301c785459d16fa0fb658fdb58cce7f85ffb85733d7bb1e1d16f27b.png" src="../_images/7f573570a301c785459d16fa0fb658fdb58cce7f85ffb85733d7bb1e1d16f27b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install pyvis</span>
<span class="kn">from</span> <span class="nn">pyvis.network</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;1024px&#39;</span><span class="p">,</span> <span class="s1">&#39;2048px&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">from_nx</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;test.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Local cdn resources have problems on chrome/safari when used in jupyter-notebook. 
</pre></div>
</div>
<div class="output text_html">
        <iframe
            width="2048px"
            height="600px"
            src="test.html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
</section>
</section>
<section id="question">
<h2>Question<a class="headerlink" href="#question" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>與Mutual Information相比，Frequency based 的缺點是什什 麼?</p></li>
<li><p>處理理 metamorphosis_franz_kafka.txt，找出三種 collocations</p>
<ul class="simple">
<li><p>Frequency-based</p></li>
<li><p>Chi-square test</p></li>
<li><p>Mutual information</p></li>
</ul>
</li>
<li><p>metamorphosis_franz_kafka.txt 裡有很多對話或⾃自⾔言⾃自語，⽤用雙 引號區別。請只⽤用括號裡的⽂文字，建立collocations</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Oh, God&quot;</span><span class="p">,</span> <span class="n">he</span> <span class="n">thought</span><span class="p">,</span> <span class="s2">&quot;what a strenuous career it is that I’ve chosen! Travelling day in and day out. Doing business like this takes much more effort than doing your own business at home, and on top of that there&#39;s the curse of travelling, worries about making train connections, bad and irregular food, contact with different people all the time so that you can never get to know anyone or become friendly with them. It can all go to Hell!&quot;</span> <span class="n">He</span> <span class="n">felt</span> <span class="n">a</span> <span class="n">slight</span> <span class="n">itch</span> <span class="n">up</span> <span class="n">on</span> <span class="n">his</span> <span class="n">belly</span><span class="p">;</span> <span class="n">pushed</span> <span class="n">himself</span> <span class="n">slowly</span> <span class="n">up</span> <span class="n">on</span> <span class="n">his</span> <span class="n">back</span> <span class="n">towards</span> <span class="n">the</span> <span class="n">headboard</span> <span class="n">so</span> <span class="n">that</span> <span class="n">he</span> <span class="n">could</span> <span class="n">lift</span> <span class="n">his</span> <span class="n">head</span> <span class="n">better</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="using-nltk">
<h2>Using NLTK<a class="headerlink" href="#using-nltk" title="Permalink to this headline">#</a></h2>
<p>Reference: <a class="reference external" href="https://zhuanlan.zhihu.com/p/403285461">https://zhuanlan.zhihu.com/p/403285461</a>
Source code of NLTK Collocation: <a class="reference external" href="https://www.nltk.org/_modules/nltk/collocations.html">https://www.nltk.org/_modules/nltk/collocations.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/corpus02.txt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of characters: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of characters: 75346
</pre></div>
</div>
</div>
</div>
<section id="preprocessing">
<h3>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="c1"># nltk.download(&#39;punkt&#39;)</span>

<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="c1"># from nltk.corpus import stopwords</span>
<span class="c1"># stopword_list = stopwords.words(&#39;english&#39;)</span>

<span class="n">raw_tokens</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">raw_tokens</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
<span class="c1">#         if token.lower() not in stopword_list: </span>
        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of tokens: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>


<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="n">stopword_list</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>

<span class="n">word_pair_nosw_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">w1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span> <span class="ow">and</span> <span class="n">w2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopword_list</span><span class="p">:</span>
        <span class="n">word_pair_nosw_counts</span><span class="p">[(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
    
<span class="k">for</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">),</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word_pair_nosw_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of tokens: 11781
working	class	23
bourgeois	society	15
class	antagonisms	11
modern	industry	11
ruling	class	11
productive	forces	9
modern	bourgeois	8
middle	ages	7
bourgeois	property	7
private	property	7
feudal	society	6
middle	class	6
social	conditions	6
property	relations	6
class	struggle	6
old	society	6
petty	bourgeois	6
existing	society	5
one	word	5
bourgeois	socialism	5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package stopwords to
[nltk_data]     /Users/jirlong/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-pmi-by-nltk">
<h3>Calculate PMI by NLTK<a class="headerlink" href="#calculate-pmi-by-nltk" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.nltk.org/api/nltk.collocations.html">https://www.nltk.org/api/nltk.collocations.html</a></p></li>
<li><p><a class="reference external" href="https://tedboy.github.io/nlps/generated/generated/nltk.BigramCollocationFinder.html">https://tedboy.github.io/nlps/generated/generated/nltk.BigramCollocationFinder.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">nltk.collocations</span> <span class="kn">import</span> <span class="n">BigramAssocMeasures</span><span class="p">,</span> <span class="n">BigramCollocationFinder</span>

<span class="n">bigram_measures</span> <span class="o">=</span> <span class="n">BigramAssocMeasures</span><span class="p">()</span>
<span class="n">finder</span> <span class="o">=</span> <span class="n">BigramCollocationFinder</span><span class="o">.</span><span class="n">from_words</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;word1  , word2,  PMI&#39;</span><span class="p">)</span>

<span class="c1"># for row in finder.nbest(bigram_measures.pmi, 20):</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">finder</span><span class="o">.</span><span class="n">score_ngrams</span><span class="p">(</span><span class="n">bigram_measures</span><span class="o">.</span><span class="n">pmi</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>  <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>word1  , word2,  PMI
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(ablaze      , restore     )	10.52
(absolutely  , requisite   )	10.52
(absurdity   , suddenly    )	10.52
(accomplished, aqueducts   )	10.52
(accomplished, egyptian    )	10.52
(accomplished, pyramids    )	10.52
(accomplished, roman       )	10.52
(accomplished, surpassing  )	10.52
(accomplished, wonders     )	10.52
(accordance  , liability   )	10.52
(act         , wrangle     )	10.52
(acuteness   , contradictions)	10.52
(admire      , fitting     )	10.52
(admire      , slothful    )	10.52
(adrift      , joins       )	10.52
(afterwards  , proper      )	10.52
(afterwards  , serving     )	10.52
(agglomerated, centralized )	10.52
(ago         , dogs        )	10.52
(ago         , sheer       )	10.52
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculating-raw-freqs-phi-and-t">
<h3>Calculating raw_freqs, phi, and t<a class="headerlink" href="#calculating-raw-freqs-phi-and-t" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">bigram_measures</span></code>還有很多不同的指標，包含<code class="docutils literal notranslate"><span class="pre">likelihood_ratio</span></code>, <code class="docutils literal notranslate"><span class="pre">raw_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">phi_sq</span></code>, <code class="docutils literal notranslate"><span class="pre">student_t</span></code>, …等可以運用。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">finder</span><span class="o">.</span><span class="n">score_ngrams</span><span class="p">(</span><span class="n">bigram_measures</span><span class="o">.</span><span class="n">phi_sq</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>  <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(der         , des         )	0.06
(enemies     , remnants    )	0.05
(deeper      , below       )	0.03
(der         , familie     )	0.03
(der         , privateigenthums)	0.03
(der         , staats      )	0.03
(der         , und         )	0.03
(des         , staats      )	0.03
(des         , stuttgart   )	0.03
(disappears  , talk        )	0.03
(familie     , des         )	0.03
(indigenous  , raw         )	0.03
(raw         , remotest    )	0.03
(representing, requirements)	0.03
(retrace     , der         )	0.03
(sinks       , deeper      )	0.03
(ursprung    , des         )	0.03
(half        , menace      )	0.03
(lamentation , half        )	0.03
(begun       , philosophers)	0.02
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">finder</span><span class="o">.</span><span class="n">score_ngrams</span><span class="p">(</span><span class="n">bigram_measures</span><span class="o">.</span><span class="n">likelihood_ratio</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>  <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2">)</span><span class="se">\t</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(working     , class       )	11.45
(no          , longer      )	10.48
(productive  , forces      )	9.05
(selling     , buying      )	8.13
(too         , much        )	7.85
(of          , production  )	6.57
(der         , des         )	6.57
(middle      , ages        )	6.25
(the         , bourgeoisie )	6.08
(half        , half        )	6.02
(the         , of          )	5.86
(more        , more        )	5.81
(class       , antagonisms )	5.80
(have        , been        )	5.76
(free        , selling     )	5.76
(based       , on          )	5.43
(community   , women       )	5.41
(conditions  , existence   )	5.40
(buying      , disappears  )	5.38
(socialist   , communist   )	5.37
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./TM"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="TM01_tokenization%28chi%29.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chinese Processing</p>
      </div>
    </a>
    <a class="right-next"
       href="TM03_POS%20Tagging.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">TM03 POS Tagging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目錄
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">TM02 Collocation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduciton-to-collocation">Introduciton to Collocation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-preprocessing">Text preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#most-frequent-tokens-term-frequency">Most Frequent Tokens: Term frequency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bigram">Bigram</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-the-most-frequent-consecutive-pair-of-word">Counting the most frequent consecutive pair of word</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-stopwords">Removing stopwords</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distant-collocations">Distant Collocations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#most-frequent-collocations-with-a-distance-of-k">Most frequent collocations with a distance of k</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">詞對的常見距離</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">詞對的平均距離</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-one-time-cases">Filtering one-time cases</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">印出平均距離最近的詞對</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">印出平均距離在中間的詞對</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-with-offset-deviation">Filtering with offset deviation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-a-higher-supportive-threshold">With a higher supportive threshold</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pearson-s-chi-square-test">Pearson’s Chi-Square Test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-bigrams">Back to bigrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chi-square-function">Chi-Square function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-compute-the-chi-squares">Now we can compute the chi-squares.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-more-frequent-bigrams">Focus on more frequent bigrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-filtering-out-the-stopwords">Now we can filtering out the stopwords</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutual-information">Mutual Information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-function-for-computing-mutual-information">Define a function for computing mutual information</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-can-filtering-out-the-collocations-containing-stopwords">Now we can filtering out the collocations containing stopwords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asking-chatgpt">Asking chatGPT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-simiplist-way-co-occurrence-count">The simiplist way: Co-occurrence count</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layout">Layout</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-layout-fruchterman-reingold">Spring layout (Fruchterman-Reingold)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#question">Question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-nltk">Using NLTK</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-pmi-by-nltk">Calculate PMI by NLTK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-raw-freqs-phi-and-t">Calculating raw_freqs, phi, and t</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
作者： JILUNG
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>